<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Expense</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#e8f5e9;font-family:Arial}
.card{
  max-width:420px;
  margin:20px auto;
  background:#fff;
  padding:15px;
  border-radius:12px;
}
h2{text-align:center;color:#2e7d32}
input,select,button{width:100%;padding:8px;margin:6px 0}
button{background:#2e7d32;color:#fff;border:none;border-radius:6px}
table{width:100%;border-collapse:collapse;font-size:13px}
td,th{border:1px solid #ccc;padding:5px;text-align:center}
</style>
</head>
<body>

<div class="card">
<h2>Admin Expense Entry</h2>

<input type="month" id="month">
<input type="date" id="date">
<input placeholder="Material / सामान" id="item">
<input type="number" placeholder="₹ Amount" id="amt">

<button onclick="save()">Save Entry</button>

<table>
<thead>
<tr><th>Date</th><th>Item</th><th>₹</th><th>Edit</th><th>Del</th></tr>
</thead>
<tbody id="list"></tbody>
</table>

<h3 id="total">Grand Total ₹0</h3>

<button onclick="download()">Download CSV</button>
<button onclick="logout()">Logout</button>
</div>

<script>
if(localStorage.login!=="admin") location.href="index.html";

let data=JSON.parse(localStorage.adminData||"[]");
let edit=-1;

function save(){
  let d={
    date:date.value,
    item:item.value,
    amt:+amt.value
  };
  if(edit>-1){ data[edit]=d; edit=-1; }
  else data.push(d);
  localStorage.adminData=JSON.stringify(data);
  item.value=amt.value="";
  render();
}

function render(){
  list.innerHTML="";
  let t=0;
  data.sort((a,b)=>a.date.localeCompare(b.date));
  data.forEach((r,i)=>{
    t+=r.amt;
    list.innerHTML+=`
    <tr>
      <td>${r.date}</td>
      <td>${r.item}</td>
      <td>${r.amt}</td>
      <td><button onclick="ed(${i})">✏</button></td>
      <td><button onclick="del(${i})">❌</button></td>
    </tr>`;
  });
  total.innerText="Grand Total ₹"+t;
}
function ed(i){
  let r=data[i];
  date.value=r.date; item.value=r.item; amt.value=r.amt;
  edit=i;
}
function del(i){
  if(confirm("Delete?")){
    data.splice(i,1);
    localStorage.adminData=JSON.stringify(data);
    render();
  }
}
function download(){
  let csv="Date,Item,Amount\n";
  data.forEach(r=>csv+=`${r.date},${r.item},${r.amt}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="expense.csv"; a.click();
}
function logout(){
  localStorage.removeItem("login");
  location.href="index.html";
}
render();
</script>
</body>
</html>
