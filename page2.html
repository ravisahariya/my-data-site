<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Digital Register</title>
<style>
body{font-family:Arial;background:#eef}
.box{background:#fff;margin:10px;padding:15px;border-radius:10px}
input,select,button{width:100%;padding:8px;margin-top:6px}
.logout{background:red;color:#fff}
.save{background:#007bff;color:#fff}
.add{background:green;color:#fff}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{border:1px solid #aaa;padding:5px;text-align:center}
</style>
</head>
<body>

<script>
if(localStorage.getItem("login")!=="yes"){
location.replace("index.html");
}
</script>

<div class="box">
<button class="logout" onclick="logout()">Logout</button>
<h3>Admin: <span id="a"></span></h3>

<input type="month" id="month">
<input type="date" id="date">

<select id="shift">
<option>Day</option>
<option>Night</option>
</select>

<select id="post"></select>
<input id="newPost" placeholder="Add Post">
<button class="add" onclick="addPost()">Add Post</button>

<select id="sign"></select>
<input id="newSign" placeholder="Add Signature">
<button class="add" onclick="addSign()">Add Signature</button>

<label>Row Font Color</label>
<input type="color" id="color" value="#000000">

<button class="save" onclick="save()">Save</button>
<p id="count"></p>

<table>
<thead>
<tr>
<th>Date</th><th>Shift</th><th>Post</th><th>Sign</th><th>Edit</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>

<button onclick="download()">Download CSV</button>
</div>

<script>
document.getElementById("a").innerText=localStorage.getItem("currentAdmin");

let editIndex=null;
let posts=JSON.parse(localStorage.getItem("posts")||'["ETP"]');
let signs=JSON.parse(localStorage.getItem("signs")||'["Ravi"]');

function fill(){
post.innerHTML=posts.map(p=>`<option>${p}</option>`).join("");
sign.innerHTML=signs.map(s=>`<option>${s}</option>`).join("");
}
fill();

function addPost(){if(newPost.value){posts.push(newPost.value);localStorage.setItem("posts",JSON.stringify(posts));newPost.value="";fill();}}
function addSign(){if(newSign.value){signs.push(newSign.value);localStorage.setItem("signs",JSON.stringify(signs));newSign.value="";fill();}}

function key(){return "data-"+month.value}

function save(){
let d=JSON.parse(localStorage.getItem(key())||"[]");
let obj={date:date.value,shift:shift.value,post:post.value,sign:sign.value,color:color.value};

if(editIndex!==null){d[editIndex]=obj;editIndex=null;}
else d.push(obj);

d.sort((a,b)=>new Date(a.date)-new Date(b.date));
localStorage.setItem(key(),JSON.stringify(d));
show();
}

function show(){
fill();
let d=JSON.parse(localStorage.getItem(key())||"[]");
let day=0,night=0;
data.innerHTML="";
d.forEach((r,i)=>{
if(r.shift==="Day")day++;else night++;
let disp=new Date(r.date).toLocaleDateString("en-GB");
data.innerHTML+=`
<tr style="color:${r.color}">
<td>${disp}</td><td>${r.shift}</td><td>${r.post}</td><td>${r.sign}</td>
<td><button onclick="editRow(${i})">Edit</button></td>
</tr>`;
});
count.innerText=`Day: ${day} | Night: ${night} | Total: ${d.length}`;
}

function editRow(i){
let d=JSON.parse(localStorage.getItem(key()));
let r=d[i];
date.value=r.date;shift.value=r.shift;post.value=r.post;sign.value=r.sign;color.value=r.color;
editIndex=i;
}

function download(){
let d=JSON.parse(localStorage.getItem(key())||"[]");
let csv="Date,Shift,Post,Sign\n";
d.forEach(r=>csv+=`${r.date},${r.shift},${r.post},${r.sign}\n`);
let a=document.createElement("a");
a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
a.download=month.value+".csv";
a.click();
}

function logout(){
localStorage.removeItem("login");
location.replace("index.html");
}

month.value=new Date().toISOString().slice(0,7);
show();
</script>

</body>
</html>
