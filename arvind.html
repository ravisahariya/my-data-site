<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Arvind Attendance</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(#e3f2fd,#bbdefb);
}
.card{
  max-width:380px;
  margin:20px auto;
  background:#fff;
  padding:15px;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,.25);
}
h2{color:#c62828;text-align:center}

input,select,button{
  width:100%;
  padding:9px;
  margin-top:8px;
  font-size:14px;
}
button{
  background:#c62828;
  color:#fff;
  border:none;
  border-radius:6px;
}
button:hover{opacity:.9}

.table-box{
  max-height:260px;
  overflow-y:auto;
  margin-top:10px;
  border:1px solid #ccc;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}

.edit{color:green;cursor:pointer}
.del{color:red;cursor:pointer}

#count{
  margin-top:8px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="card">
<h2>Arvind Attendance Entry</h2>

<input type="month" id="month" onchange="render()">
<input type="date" id="date">
<input id="day" readonly placeholder="Day">

<select id="shift">
  <option>Day</option>
  <option>Night</option>
</select>

<select id="post">
  <option>COE</option>
  <option>ETP</option>
  <option>ABEER</option>
  <option>DENIEM</option>
  <option>ACL</option>
  <option>BORD2</option>
  <option>CASUAL</option>
  <option>CCTV</option>
</select>

<input type="color" id="color">

<button onclick="save()">Save Entry</button>

<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th><th>Day</th><th>Shift</th><th>Post</th><th>Edit</th><th>Del</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<div id="count"></div>

<button onclick="csv()">Download CSV</button>
<button onclick="logout()">Logout</button>
</div>

<script>
/* सुरक्षा */
if(localStorage.login!=="arvind") location.href="index.html";

let data = JSON.parse(localStorage.attendance || "[]");
let editIndex = -1;

date.onchange=()=>{
 let d=new Date(date.value);
 day.value=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];
};

function format(d){
 let x=new Date(d);
 return String(x.getDate()).padStart(2,"0")+"-"+String(x.getMonth()+1).padStart(2,"0")+"-"+x.getFullYear();
}

function save(){
 let obj={
  date:date.value,
  day:day.value,
  shift:shift.value,
  post:post.value,
  color:color.value
 };
 if(editIndex>-1){
  data[editIndex]=obj;
  editIndex=-1;
 }else data.push(obj);

 localStorage.attendance=JSON.stringify(data);
 render();
}

function render(){
 list.innerHTML="";
 let d=0,n=0;
 let m=month.value;

 data
 .filter(r=>!m || r.date.startsWith(m))
 .sort((a,b)=>a.date.localeCompare(b.date))
 .forEach((r,i)=>{
  r.shift==="Day"?d++:n++;
  list.innerHTML+=`
  <tr style="color:${r.color}">
   <td>${format(r.date)}</td>
   <td>${r.day}</td>
   <td>${r.shift}</td>
   <td>${r.post}</td>
   <td class="edit" onclick="edit(${i})">✏️</td>
   <td class="del" onclick="del(${i})">❌</td>
  </tr>`;
 });
 count.innerText=`Day: ${d} | Night: ${n} | Total: ${d+n}`;
}

function edit(i){
 editIndex=i;
 let r=data[i];
 date.value=r.date;
 day.value=r.day;
 shift.value=r.shift;
 post.value=r.post;
 color.value=r.color;
}

function del(i){
 if(confirm("Delete entry?")){
  data.splice(i,1);
  localStorage.attendance=JSON.stringify(data);
  render();
 }
}

function csv(){
 let t="Date,Day,Shift,Post\n";
 data.forEach(r=>{
  t+=`${format(r.date)},${r.day},${r.shift},${r.post}\n`;
 });
 let a=document.createElement("a");
 a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(t);
 a.download="attendance.csv";
 a.click();
}

function logout(){
 localStorage.removeItem("login");
 location.href="index.html";
}

render();
</script>

</body>
</html>
