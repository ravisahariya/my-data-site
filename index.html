<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Attendance MASTER PRO</title>

<style>
body{margin:0;font-family:Arial;background:#f2f4f8}

/* ===== LOGIN ===== */
#login{
height:100vh;
display:flex;
align-items:center;
justify-content:center;
background:linear-gradient(135deg,#6a6cff,#9c6cff);
}

.card{
background:#fff;
padding:40px;
border-radius:20px;
width:380px;
text-align:center;
box-shadow:0 15px 40px rgba(0,0,0,.3);
}

.card input{
width:95%;
padding:10px;
margin:8px 0;
}

/* ===== APP ===== */
#app{display:none;height:100vh;flex-direction:column}

header{
background:#fff;
padding:8px;
position:sticky;
top:0;
box-shadow:0 2px 6px #ccc;
z-index:10;
}

footer{
background:#ffe7a1;
padding:8px;
font-weight:bold;
position:sticky;
bottom:0;
}

.tableWrap{flex:1;overflow:auto}

table{
width:100%;
border-collapse:collapse;
}

th,td{
border:1px solid #ccc;
padding:6px;
text-align:center;
}

th{background:#ffdede}

button{cursor:pointer}
.logout{background:red;color:white}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
<div class="card">
<h2>üëÜ Attendance Login</h2>

<input id="u" placeholder="User ID">
<input id="p" type="password" placeholder="Password">

<button onclick="doLogin()">Login</button>
<br>
<small onclick="secret()">üîí Secret</small>
</div>
</div>


<!-- APP -->
<div id="app">

<header>
Date <input type="date" id="d">
In <input type="time" id="i">
Out <input type="time" id="o">
Post <input id="post">

BG <input type="color" id="bg" value="#ffffff">
Font <input type="color" id="font" value="#000000">

<button onclick="save()">Save</button>
<button onclick="clearForm()">Clear</button>

<select id="month" onchange="render()"></select>
<input id="search" placeholder="Search" onkeyup="render()">

<button onclick="excel()">Excel</button>
<button onclick="window.print()">Print</button>
<button class="logout" onclick="logout()">Logout</button>
</header>


<div class="tableWrap">
<table>
<thead>
<tr>
<th>Date</th>
<th>In</th>
<th>Out</th>
<th>Hours</th>
<th>Post</th>
<th>Edit</th>
<th>Delete</th>
</tr>
</thead>
<tbody id="tb"></tbody>
</table>
</div>

<footer id="foot"></footer>

</div>


<script>

/* ========= LOGIN ========= */
function doLogin(){
if(u.value==="9823087" && p.value==="7284"){
localStorage.setItem("login","yes");
start();
}else alert("Wrong Login");
}

function logout(){
localStorage.removeItem("login");
location.reload();
}

function secret(){
let y=prompt("Enter year");
if(y==="1995") alert("User: 9823087\nPass: 7284");
}

if(localStorage.getItem("login")) start();

function start(){
login.style.display="none";
app.style.display="flex";
initMonth();
render();
}


/* ========= DATA ========= */
let data = JSON.parse(localStorage.getItem("data")||"[]");

function saveData(){
localStorage.setItem("data",JSON.stringify(data));
}

function hours(a,b){
let s=new Date("2020-01-01 "+a);
let e=new Date("2020-01-01 "+b);
if(e<s)e.setDate(e.getDate()+1);
return ((e-s)/3600000).toFixed(2);
}


/* ========= SAVE ========= */
function save(){

let obj={
id:Date.now(),
date:d.value,
in:i.value,
out:o.value,
post:post.value,
bg:bg.value,
font:font.value
};

let editIndex=data.findIndex(x=>x.editing);
if(editIndex>=0) data[editIndex]=obj;
else data.push(obj);

data.forEach(x=>delete x.editing);

saveData();
render();
clearForm();
}

function clearForm(){
d.value=i.value=o.value=post.value="";
}


/* ========= RENDER ========= */
function render(){

let m=month.value;
let s=search.value.toLowerCase();

let list=data.filter(x=>{
let ok=true;
if(m!="all") ok=x.date.slice(5,7)==m;
if(s) ok=x.post.toLowerCase().includes(s);
return ok;
});

list.sort((a,b)=>{
if(a.date==b.date) return a.in.localeCompare(b.in);
return a.date.localeCompare(b.date);
});

tb.innerHTML="";
let total=0;

list.forEach(r=>{
let h=hours(r.in,r.out);
total+=+h;

let tr=document.createElement("tr");
tr.style.background=r.bg;
tr.style.color=r.font;

tr.innerHTML=`
<td>${r.date}</td>
<td>${r.in}</td>
<td>${r.out}</td>
<td>${h}</td>
<td>${r.post}</td>
<td><button onclick="edit(${r.id})">‚úèÔ∏è</button></td>
<td><button onclick="del(${r.id})">‚ùå</button></td>
`;

tb.appendChild(tr);
});

foot.innerText="Total Duty: "+list.length+" | Total Hours: "+total.toFixed(2);
}


/* ========= EDIT DELETE ========= */
function edit(id){
let r=data.find(x=>x.id==id);
d.value=r.date;
i.value=r.in;
o.value=r.out;
post.value=r.post;
bg.value=r.bg;
font.value=r.font;
r.editing=true;
}

function del(id){
if(confirm("Delete?")){
data=data.filter(x=>x.id!=id);
saveData();
render();
}
}


/* ========= MONTH ========= */
function initMonth(){
let cur=new Date().getMonth()+1;
month.innerHTML='<option value="all">All</option>';
for(let i=1;i<=12;i++){
let m=i.toString().padStart(2,'0');
let o=document.createElement("option");
o.value=m;
o.text=m;
if(i==cur)o.selected=true;
month.appendChild(o);
}
}


/* ========= EXCEL ========= */
function excel(){
let rows=[...document.querySelectorAll("table tr")];
let csv=rows.map(r=>[...r.children].map(c=>c.innerText).join(",")).join("\n");
let blob=new Blob([csv]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="attendance.csv";
a.click();
}

</script>

</body>
</html>
