<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Attendance</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f5132;
  color:#000;
}
.hidden{display:none;}
.card{
  background:#fff;
  max-width:420px;
  margin:40px auto;
  padding:20px;
  border-radius:12px;
  position:relative;
}
h2{text-align:center;margin:10px 0;}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
}
button{
  background:#0f5132;
  color:#fff;
  border:none;
  border-radius:6px;
}
.settings{
  position:absolute;
  right:12px;
  top:12px;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:13px;
}
th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.popup div{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:260px;
}
</style>
</head>

<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="card">
  <h2>üë§ Admin Login</h2>
  <select>
    <option><b>ADMIN</b></option>
  </select>
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- APP PAGE -->
<div id="appPage" class="card hidden">
  <span class="settings" onclick="openSettings()">‚öôÔ∏è</span>
  <h2>Register + Attendance</h2>

  <select id="month"></select>

  <input type="date" id="date">

  <select id="shift">
    <option>Day</option>
    <option>Night</option>
  </select>

  <select id="post">
    <option>COE</option>
    <option>ABEER</option>
    <option>DENIEM</option>
    <option>ETP</option>
    <option>ACL</option>
    <option>BORD2</option>
    <option>CASUAL</option>
    <option>CCTV</option>
  </select>

  <select id="sign">
    <option>Ravi</option>
  </select>

  <input type="color" id="rowColor" value="#ffffff">

  <button onclick="saveEntry()">Save Entry</button>
  <button onclick="downloadCSV()">Download CSV</button>

  <table>
    <thead>
      <tr>
        <th>Date</th><th>Shift</th><th>Post</th><th>Sign</th><th>Edit</th><th>Delete</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="dayTotal">0</th>
        <th id="nightTotal">0</th>
        <th colspan="3"></th>
      </tr>
    </tfoot>
  </table>
</div>

<!-- SETTINGS -->
<div id="settingsPopup" class="popup hidden">
  <div>
    <h3>Settings</h3>
    <button onclick="logout()">Logout</button><br><br>
    <button onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
const PASS="7024";
const key="attendanceData";

function login(){
  if(password.value===PASS){
    localStorage.setItem("login","yes");
    showApp();
  }else alert("Wrong Password");
}

function showApp(){
  loginPage.classList.add("hidden");
  appPage.classList.remove("hidden");
}

function logout(){
  localStorage.removeItem("login");
  appPage.classList.add("hidden");
  loginPage.classList.remove("hidden");
  closeSettings();
}

function openSettings(){settingsPopup.classList.remove("hidden");}
function closeSettings(){settingsPopup.classList.add("hidden");}

if(localStorage.getItem("login")==="yes") showApp();

const monthSel=document.getElementById("month");
["January","February","March","April","May","June","July","August","September","October","November","December"]
.forEach(m=>monthSel.innerHTML+=`<option>${m}</option>`);

function getData(){
  return JSON.parse(localStorage.getItem(key)||"[]");
}

function saveEntry(){
  if(!date.value){alert("Date required");return;}
  const data=getData();
  data.push({
    date:date.value,
    shift:shift.value,
    post:post.value,
    sign:sign.value,
    color:rowColor.value
  });
  localStorage.setItem(key,JSON.stringify(data));
  render();
}

function render(){
  const data=getData().sort((a,b)=>a.date.localeCompare(b.date));
  tableBody.innerHTML="";
  let d=0,n=0;
  data.forEach((r,i)=>{
    if(r.shift==="Day")d++; else n++;
    tableBody.innerHTML+=`
    <tr style="background:${r.color}">
      <td>${r.date}</td>
      <td>${r.shift}</td>
      <td>${r.post}</td>
      <td>${r.sign}</td>
      <td><button onclick="editRow(${i})">‚úèÔ∏è</button></td>
      <td><button onclick="delRow(${i})">üóë</button></td>
    </tr>`;
  });
  dayTotal.innerText=d;
  nightTotal.innerText=n;
}

function delRow(i){
  if(confirm("Delete entry?")){
    const d=getData(); d.splice(i,1);
    localStorage.setItem(key,JSON.stringify(d));
    render();
  }
}

function editRow(i){
  const d=getData()[i];
  date.value=d.date;
  shift.value=d.shift;
  post.value=d.post;
  sign.value=d.sign;
  rowColor.value=d.color;
  delRow(i);
}

function downloadCSV(){
  let csv="Date,Shift,Post,Sign\n";
  getData().forEach(r=>csv+=`${r.date},${r.shift},${r.post},${r.sign}\n`);
  const a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
  a.download="attendance.csv";
  a.click();
}

render();
</script>
</body>
</html>
