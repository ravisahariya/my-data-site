<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Attendance MASTER Cloud</title>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#5f6df5,#7b5cff);
height:100vh;
overflow:hidden;
}

/* LOGIN */
#loginPage{
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.loginCard{
background:white;
width:90%;
max-width:420px;
padding:40px;
border-radius:18px;
text-align:center;
box-shadow:0 15px 40px rgba(0,0,0,.25);
}

.loginCard input{
width:100%;
padding:14px;
margin:10px 0;
font-size:18px;
}

.loginCard button{
padding:12px 30px;
font-size:18px;
}

/* DASHBOARD */
#app{display:none;height:100vh;flex-direction:column}

header{
background:#222;
color:white;
padding:12px;
display:flex;
justify-content:space-between;
font-size:20px;
}

footer{
background:#ffe89a;
padding:8px;
font-weight:bold;
}

.tableWrap{
flex:1;
overflow:auto;
}

table{
width:100%;
border-collapse:collapse;
background:white;
}

th,td{
border:1px solid #ccc;
padding:8px;
text-align:center;
}

.controls{
background:#fff;
padding:10px;
display:flex;
flex-wrap:wrap;
gap:5px;
}

.controls input,select,button{
padding:6px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="loginCard">
    <h2>üîê Attendance Login</h2>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p style="cursor:pointer" onclick="alert('User: Ravi\nPass: Ravi123')">üîí Secret</p>
  </div>
</div>

<!-- APP -->
<div id="app">

<header>
 Attendance MASTER
 <button onclick="logout()">Logout</button>
</header>

<div class="controls">
<input type="date" id="date">
<input type="time" id="in">
<input type="time" id="out">
<input id="post" placeholder="Post">
<button onclick="save()">Save</button>
<button onclick="download()">Excel</button>
<button onclick="window.print()">Print</button>
<input id="search" placeholder="Search post" oninput="render()">
<select id="month" onchange="render()">
<option value="all">All</option>
</select>
</div>

<div class="tableWrap">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th><th>Post</th><th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<footer>
Total Duty: <span id="duty">0</span> |
Total Hours: <span id="hours">0</span>
</footer>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ===== YOUR FIREBASE CONFIG ===== */
const firebaseConfig = {
 apiKey: "YOUR_API_KEY",
 authDomain: "YOUR_DOMAIN",
 projectId: "YOUR_ID"
};
/* =============================== */

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const col = collection(db,"attendance");

let rows=[];
let editId=null;

/* LOGIN REMEMBER */
if(localStorage.getItem("login")=="yes"){
 showApp();
}

/* LOGIN */
window.login=()=>{
 if(user.value==="Ravi" && pass.value==="Ravi123"){
  localStorage.setItem("login","yes");
  showApp();
 }else alert("Wrong login");
}

window.logout=()=>{
 localStorage.removeItem("login");
 location.reload();
}

function showApp(){
 loginPage.style.display="none";
 app.style.display="flex";
}

/* FIREBASE REALTIME */
onSnapshot(col,snap=>{
 rows=[];
 snap.forEach(d=>rows.push({id:d.id,...d.data()}));
 render();
});

/* SAVE */
window.save=async()=>{
 let d=date.value;
 let i=in.value;
 let o=out.value;
 let p=post.value;

 let h=((new Date("1970-01-01T"+o)-new Date("1970-01-01T"+i))/3600000);
 if(h<0) h+=24;

 if(editId){
  await updateDoc(doc(db,"attendance",editId),{d,i,o,h,p});
  editId=null;
 }else{
  await addDoc(col,{d,i,o,h,p});
 }

 date.value=in.value=out.value=post.value="";
}

/* RENDER */
window.render=()=>{
 let searchText=search.value.toLowerCase();
 let m=month.value;

 let body="";
 let totalH=0,totalD=0;

 rows
 .filter(r=>{
  let ok=r.p.toLowerCase().includes(searchText);
  if(m!=="all") ok=ok && r.d.slice(0,7)==m;
  return ok;
 })
 .sort((a,b)=>a.d.localeCompare(b.d))
 .forEach(r=>{
  totalH+=r.h;
  totalD++;

  body+=`
  <tr>
   <td>${r.d}</td>
   <td>${r.i}</td>
   <td>${r.o}</td>
   <td>${r.h.toFixed(2)}</td>
   <td>${r.p}</td>
   <td><button onclick="editRow('${r.id}')">‚úèÔ∏è</button></td>
   <td><button onclick="del('${r.id}')">‚ùå</button></td>
  </tr>`;
 });

 tbody.innerHTML=body;
 duty.innerText=totalD;
 hours.innerText=totalH.toFixed(2);
}

/* EDIT */
window.editRow=id=>{
 let r=rows.find(x=>x.id==id);
 date.value=r.d;
 in.value=r.i;
 out.value=r.o;
 post.value=r.p;
 editId=id;
}

/* DELETE */
window.del=async(id)=>{
 if(confirm("Delete?")) await deleteDoc(doc(db,"attendance",id));
}

/* EXCEL */
window.download=()=>{
 let csv="Date,In,Out,Hours,Post\n";
 rows.forEach(r=>{
  csv+=`${r.d},${r.i},${r.o},${r.h},${r.p}\n`;
 });
 let blob=new Blob([csv]);
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="attendance.csv";
 a.click();
}

/* MONTH LIST */
let now=new Date();
let ym=now.toISOString().slice(0,7);
for(let i=0;i<12;i++){
 let d=new Date(now.getFullYear(),i,1);
 let v=d.toISOString().slice(0,7);
 month.innerHTML+=`<option value="${v}">${v}</option>`;
}
month.value=ym;

</script>

</body>
</html>
