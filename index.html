<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Attendance App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b5ed7">

<style>
body{
 margin:0;
 min-height:100vh;
 background:linear-gradient(#9fdcff,#e8f6ff);
 font-family:Arial;
 display:flex;
 justify-content:center;
 align-items:center;
}
.card{
 background:#fff;
 width:95%;
 max-width:460px;
 padding:20px;
 border-radius:14px;
 box-shadow:0 10px 25px rgba(0,0,0,.25);
}
h2{text-align:center}
input,select,button{
 width:100%;
 padding:10px;
 margin:6px 0;
 font-size:15px;
}
button{
 border:none;
 border-radius:6px;
 font-weight:bold;
 cursor:pointer;
}
.blue{background:#0b5ed7;color:#fff}
.red{background:#b00000;color:#fff}
.green{background:#198754;color:#fff}
.hidden{display:none}

/* TABLE + SCROLL */
.table-box{
 max-height:260px;
 overflow-y:auto;
 border:1px solid #ccc;
 margin-top:8px;
}
table{
 width:100%;
 border-collapse:collapse;
 font-size:13px;
}
th,td{
 border:1px solid #ccc;
 padding:6px;
 text-align:center;
}
.signature{font-family:cursive}
.actions button{
 width:auto;
 padding:4px 6px;
 margin:0 2px;
}
.total{
 font-weight:bold;
 margin:8px 0;
}
</style>
</head>

<body>

<!-- üîê LOGIN -->
<div class="card" id="loginBox">
 <h2>Admin Login</h2>
 <select disabled><option>ADMIN</option></select>
 <input type="password" id="password" placeholder="Password (7024)">
 <button class="blue" onclick="login()">Login</button>
</div>

<!-- üìù APP -->
<div class="card hidden" id="appBox">
 <h2>Attendance Entry</h2>

 <!-- MONTH DROPDOWN -->
 <select id="monthFilter" onchange="renderTable()">
  <option value="">All Months</option>
  <option value="01">January</option>
  <option value="02">February</option>
  <option value="03">March</option>
  <option value="04">April</option>
  <option value="05">May</option>
  <option value="06">June</option>
  <option value="07">July</option>
  <option value="08">August</option>
  <option value="09">September</option>
  <option value="10">October</option>
  <option value="11">November</option>
  <option value="12">December</option>
 </select>

 <input type="date" id="date">

 <select id="shift">
  <option>Day</option>
  <option>Night</option>
 </select>

 <select id="post">
  <option>COE</option><option>ABEER</option><option>DENIEM</option>
  <option>ETP</option><option>ACL</option><option>BORD2</option>
  <option>CASUAL</option><option>CCTV</option>
 </select>

 <select id="name" class="signature">
  <option>Ravi</option>
 </select>

 <input type="color" id="fontColor">

 <button class="blue" onclick="saveEntry()">Save Entry</button>

 <div class="table-box">
 <table>
  <thead>
   <tr>
    <th>Date</th>
    <th>Day</th>
    <th>Shift</th>
    <th>Post</th>
    <th>Name</th>
    <th>Action</th>
   </tr>
  </thead>
  <tbody id="tableBody"></tbody>
 </table>
 </div>

 <div class="total" id="totalText"></div>

 <button class="green" onclick="downloadCSV()">‚¨á Download CSV</button>
 <button class="red" onclick="logout()">Logout</button>
</div>

<script>
let entries = JSON.parse(localStorage.getItem("attendanceData") || "[]");
let editIndex = null;

function speak(text){
 speechSynthesis.speak(new SpeechSynthesisUtterance(text));
}

/* LOGIN */
function login(){
 if(password.value==="7024"){
  speak("Login ho gaya hai");
  loginBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  localStorage.setItem("logged","yes");
  renderTable();
 }else alert("Wrong password");
}

/* AUTO LOGIN */
if(localStorage.getItem("logged")==="yes"){
 loginBox.classList.add("hidden");
 appBox.classList.remove("hidden");
}

/* LOGOUT */
function logout(){
 localStorage.removeItem("logged");
 location.reload();
}

/* SAVE */
function saveEntry(){
 if(!date.value){alert("Date select karo");return;}

 const d = new Date(date.value);
 const dayName = d.toLocaleDateString("en",{weekday:"long"});
 const dd = String(d.getDate()).padStart(2,"0");
 const mm = String(d.getMonth()+1).padStart(2,"0");
 const yyyy = d.getFullYear();

 const obj = {
  rawDate: date.value,
  showDate: `${dd}-${mm}-${yyyy}`,
  month: mm,
  day: dayName,
  shift: shift.value,
  post: post.value,
  name: name.value,
  color: fontColor.value
 };

 if(editIndex !== null){
  entries[editIndex] = obj;
  editIndex = null;
 }else{
  entries.push(obj);
 }

 localStorage.setItem("attendanceData",JSON.stringify(entries));
 renderTable();
}

/* RENDER */
function renderTable(){
 tableBody.innerHTML="";
 let dayCount=0, nightCount=0;
 let m = monthFilter.value;

 let filtered = entries.filter(e=> !m || e.month===m);
 filtered.sort((a,b)=> new Date(a.rawDate)-new Date(b.rawDate));

 filtered.forEach((e,i)=>{
  if(e.shift==="Day") dayCount++; else nightCount++;
  tableBody.innerHTML += `
   <tr style="color:${e.color}">
    <td>${e.showDate}</td>
    <td>${e.day}</td>
    <td>${e.shift}</td>
    <td>${e.post}</td>
    <td class="signature">${e.name}</td>
    <td class="actions">
     <button class="green" onclick="editRow(${i})">‚úè</button>
     <button class="red" onclick="deleteRow(${i})">‚úñ</button>
    </td>
   </tr>`;
 });

 totalText.innerText =
  `Total Day: ${dayCount} | Total Night: ${nightCount} | Grand Total: ${dayCount+nightCount}`;
}

/* EDIT */
function editRow(i){
 let e = entries[i];
 date.value = e.rawDate;
 shift.value = e.shift;
 post.value = e.post;
 name.value = e.name;
 fontColor.value = e.color;
 editIndex = i;
}

/* DELETE */
function deleteRow(i){
 if(confirm("Delete entry?")){
  entries.splice(i,1);
  localStorage.setItem("attendanceData",JSON.stringify(entries));
  renderTable();
 }
}

/* CSV */
function downloadCSV(){
 let m = monthFilter.value;
 let filtered = entries.filter(e=>!m || e.month===m);
 let csv="Date,Day,Shift,Post,Name\n";
 filtered.forEach(e=>{
  csv+=`${e.showDate},${e.day},${e.shift},${e.post},${e.name}\n`;
 });
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
 a.download="attendance.csv";
 a.click();
}
</script>

<script>
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
  </html>
