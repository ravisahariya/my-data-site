<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Attendance Register</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f5132;
}
.hidden{display:none}
.box{
  max-width:420px;
  margin:40px auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
h2{text-align:center;margin:10px 0}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:14px;
}
button{
  border:none;
  border-radius:5px;
  cursor:pointer;
}
.green{background:#0f5132;color:#fff}
.red{background:#dc3545;color:#fff}
.blue{background:#0d6efd;color:#fff}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:13px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
.settings{
  float:right;
  cursor:pointer;
  font-size:18px;
}
.count{
  font-weight:bold;
  margin-top:5px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="box" id="login">
  <h2>üë®‚Äçüíº Admin Login</h2>
  <select>
    <option><b>ADMIN</b></option>
  </select>
  <input type="password" id="password" placeholder="Password">
  <button class="green" onclick="login()">Login</button>
</div>

<!-- APP -->
<div class="box hidden" id="app">
  <span class="settings">‚öôÔ∏è</span>
  <h2>Register + Attendance</h2>

  <select id="month">
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <input type="number" id="date" placeholder="Date (1-31)">

  <select id="shift">
    <option>Day</option>
    <option>Night</option>
  </select>

  <select id="status">
    <option>Present</option>
    <option>Absent</option>
  </select>

  <select id="post">
    <option>ETP</option>
    <option>COE</option>
    <option>ACL</option>
    <option>AMBER</option>
  </select>

  <input type="text" id="newPost" placeholder="Add new post">
  <button class="blue" onclick="addPost()">Add Post</button>

  <select id="sign">
    <option>Ravi</option>
  </select>

  <label>Row Color</label>
  <input type="color" id="rowColor" value="#ffffff">

  <button class="green" onclick="save()">Save Entry</button>

  <div class="count" id="count"></div>

  <table>
    <thead>
      <tr>
        <th>Date</th><th>Shift</th><th>Status</th>
        <th>Post</th><th>Sign</th><th>Edit</th><th>Delete</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <button class="blue" onclick="downloadCSV()">Download CSV</button>
  <button class="red" onclick="logout()">Logout</button>
</div>

<script>
const PASSWORD="7024";
let data=JSON.parse(localStorage.getItem("attendance")||"[]");

function login(){
  if(document.getElementById("password").value===PASSWORD){
    loginBox(false); render();
  }else alert("Wrong Password ‚ùå");
}
function logout(){
  loginBox(true);
}
function loginBox(show){
  document.getElementById("login").classList.toggle("hidden",!show);
  document.getElementById("app").classList.toggle("hidden",show);
}

function addPost(){
  let p=document.getElementById("newPost").value.trim();
  if(!p)return;
  let sel=document.getElementById("post");
  sel.innerHTML+=`<option>${p}</option>`;
  document.getElementById("newPost").value="";
}

function save(){
  let obj={
    month:month.value,
    date:+date.value,
    shift:shift.value,
    status:status.value,
    post:post.value,
    sign:sign.value,
    color:rowColor.value
  };
  if(!obj.date)return alert("Date required");
  data.push(obj);
  localStorage.setItem("attendance",JSON.stringify(data));
  render();
}

function render(){
  rows.innerHTML="";
  let d=0,n=0;
  data.sort((a,b)=>a.date-b.date);
  data.forEach((r,i)=>{
    if(r.shift==="Day"&&r.status==="Present")d++;
    if(r.shift==="Night"&&r.status==="Present")n++;
    rows.innerHTML+=`
    <tr style="color:${r.color}">
      <td>${r.date}</td><td>${r.shift}</td><td>${r.status}</td>
      <td>${r.post}</td><td>${r.sign}</td>
      <td><button onclick="edit(${i})">‚úèÔ∏è</button></td>
      <td><button onclick="del(${i})">üóëÔ∏è</button></td>
    </tr>`;
  });
  count.innerText=`Day: ${d} | Night: ${n} | Total: ${d+n}`;
}

function edit(i){
  let r=data[i];
  date.value=r.date; shift.value=r.shift;
  status.value=r.status; post.value=r.post;
  rowColor.value=r.color;
  data.splice(i,1);
  localStorage.setItem("attendance",JSON.stringify(data));
}

function del(i){
  if(confirm("Delete entry?")){
    data.splice(i,1);
    localStorage.setItem("attendance",JSON.stringify(data));
    render();
  }
}

function downloadCSV(){
  let csv="Date,Shift,Status,Post,Sign\n";
  data.forEach(r=>{
    csv+=`${r.date},${r.shift},${r.status},${r.post},${r.sign}\n`;
  });
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="attendance.csv";
  a.click();
}
</script>

</body>
</html>
