<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Master Attendance Sheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial;
  background:#eaeaea;
  min-height:100vh;
}
.screen{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* LOGIN */
#loginPage{
  width:90%;
  max-width:380px;
  background:#fff;
  padding:25px;
  border-radius:15px;
  box-shadow:0 0 15px rgba(0,0,0,.3);
  text-align:center;
}
#loginPage input{
  width:100%;
  padding:12px;
  margin:8px 0;
  font-size:16px;
}
#loginPage button{
  width:100%;
  padding:12px;
  background:#0d6efd;
  color:#fff;
  border:none;
  border-radius:10px;
  font-size:18px;
}
.secret{margin-top:10px;cursor:pointer}
#secretBox{display:none;font-size:14px}

/* MAIN */
#mainPage{
  width:100%;
  max-width:1100px;
  height:95vh;
  background:#fff;
  border-radius:15px;
  box-shadow:0 0 15px rgba(0,0,0,.3);
  display:flex;
  flex-direction:column;
}
.header{
  background:#0d6efd;
  color:#fff;
  padding:12px;
  font-size:22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-radius:15px 15px 0 0;
}
.logout{
  background:red;
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:8px;
}

/* SUMMARY */
.summary{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  padding:10px;
}
.box{
  padding:12px;
  color:#fff;
  border-radius:10px;
  text-align:center;
  font-weight:bold;
}
.box span{display:block;font-size:26px}
.b1{background:#198754}
.b2{background:#fd7e14}
.b3{background:#6f42c1}

/* FORM */
.form{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:8px;
  padding:10px;
}
.form input,.form select{padding:8px}
.add{
  background:#0d6efd;
  color:#fff;
  border:none;
  border-radius:8px;
}

/* TABLE */
.tableWrap{
  flex:1;
  margin:10px;
  overflow:auto;
  border:1px solid #ccc;
  border-radius:10px;
}
table{width:100%;border-collapse:collapse}
th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
  text-align:center
}
th{
  background:#f1f1f1;
  position:sticky;
  top:0
}
.edit{background:orange;color:#fff;border:none;padding:5px;border-radius:6px}
.del{background:red;color:#fff;border:none;padding:5px;border-radius:6px}

.hidden{display:none!important}
.note{font-size:12px;color:#666;padding:0 10px}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="screen">
  <div id="loginPage">
    <h2>Login</h2>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">LOGIN</button>
    <div class="secret" onclick="openSecret()">üîí</div>
    <div id="secretBox"></div>
  </div>
</div>

<!-- MAIN SCREEN -->
<div id="mainScreen" class="screen hidden">
  <div id="mainPage">

    <div class="header">
      Master Attendance Sheet
      <button class="logout" onclick="logout()">Logout</button>
    </div>

    <div class="summary">
      <div class="box b1">Total Days<span id="tDays">0</span></div>
      <div class="box b2">Total Hours<span id="tHours">0</span></div>
      <div class="box b3">Total Posts<span id="tPosts">0</span></div>
    </div>

    <div class="form">
      <input type="date" id="date">
      <input type="time" id="inTime">
      <input type="time" id="outTime">
      <input id="post" placeholder="Post">
      <select id="monthFilter"></select>
      <button class="add" onclick="addEntry()">ADD</button>
      <button class="add" onclick="downloadCSV()">Download</button>
    </div>

    <div class="note">
      Default: sirf current month ka data dikhai deta hai.  
      ‚ÄúAll Months‚Äù select karne par pura data dikhega.
    </div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>In</th>
            <th>Out</th>
            <th>Hours</th>
            <th>Post</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

  </div>
</div>

<script>
const USERNAME="9823087";
const PASSWORD="7284";
let editIndex=null;

/* SCREEN */
function showLogin(){
  loginScreen.classList.remove("hidden");
  mainScreen.classList.add("hidden");
}
function showMain(){
  loginScreen.classList.add("hidden");
  mainScreen.classList.remove("hidden");
}

/* LOGIN */
function login(){
  if(user.value===USERNAME && pass.value===PASSWORD){
    localStorage.setItem("login","yes");
    initMonths();
    autoDate();
    render();
    showMain();
  }else{
    alert("Wrong Login");
  }
}
function logout(){
  localStorage.removeItem("login");
  showLogin();
}
function openSecret(){
  let x=prompt("Enter Secret Code");
  if(x==="1996"){
    secretBox.style.display="block";
    secretBox.innerHTML="Username: "+USERNAME+"<br>Password: "+PASSWORD;
  }
}

/* DATA */
function getData(){
  return JSON.parse(localStorage.getItem("att")||"[]");
}
function setData(d){
  localStorage.setItem("att",JSON.stringify(d));
}

/* DATE */
function autoDate(){
  date.value=new Date().toISOString().slice(0,10);
}

/* MONTHS */
function initMonths(){
  let months=[
    "All Months","January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];
  monthFilter.innerHTML="";
  months.forEach((m,i)=>{
    let o=document.createElement("option");
    o.value=i;
    o.text=m;
    monthFilter.appendChild(o);
  });
  monthFilter.value=new Date().getMonth()+1; // current month only
}

/* ADD / EDIT */
function addEntry(){
  let d=date.value,i=inTime.value,o=outTime.value,p=post.value;
  if(!d||!p){alert("Date & Post required");return;}

  let h=0;
  if(i&&o){
    h=(new Date(d+"T"+o)-new Date(d+"T"+i))/3600000;
    if(h<0)h=0;
  }

  let arr=getData();
  if(editIndex!==null){
    arr[editIndex]={date:d,in:i,out:o,hours:h.toFixed(2),post:p};
    editIndex=null;
  }else{
    arr.push({date:d,in:i,out:o,hours:h.toFixed(2),post:p});
  }
  setData(arr);
  autoDate();
  inTime.value=outTime.value=post.value="";
  render();
}

function edit(i){
  let arr=getData().sort((a,b)=>new Date(a.date)-new Date(b.date));
  let r=arr[i];
  date.value=r.date;
  inTime.value=r.in;
  outTime.value=r.out;
  post.value=r.post;
  editIndex=i;
}

function del(i){
  if(confirm("Delete this entry?")){
    let arr=getData();
    arr.splice(i,1);
    setData(arr);
    render();
  }
}

/* RENDER */
function render(){
  let arr=getData().sort((a,b)=>new Date(a.date)-new Date(b.date));
  let mSel=monthFilter.value;
  let body="",hrs=0,posts=[],dates=new Set();

  arr.forEach((r,i)=>{
    let mm=new Date(r.date).getMonth()+1;
    if(mSel==0 || mm==mSel){
      hrs+=+r.hours;
      posts.push(r.post);
      dates.add(r.date);
      body+=`
      <tr>
        <td>${r.date}</td>
        <td>${r.in||"-"}</td>
        <td>${r.out||"-"}</td>
        <td>${r.hours}</td>
        <td>${r.post}</td>
        <td>
          <button class="edit" onclick="edit(${i})">Edit</button>
          ${editIndex===null?`<button class="del" onclick="del(${i})">Delete</button>`:""}
        </td>
      </tr>`;
    }
  });

  tbody.innerHTML=body;
  tDays.innerHTML=dates.size;                  // UNIQUE DATE COUNT
  tHours.innerHTML=hrs.toFixed(2);
  tPosts.innerHTML=[...new Set(posts)].length;
}

/* DOWNLOAD */
function downloadCSV(){
  let arr=getData();
  let csv="Date,In,Out,Hours,Post\n";
  arr.forEach(r=>{
    csv+=`${r.date},${r.in},${r.out},${r.hours},${r.post}\n`;
  });
  let a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
  a.download="attendance.csv";
  a.click();
}

/* AUTO LOGIN */
if(localStorage.getItem("login")==="yes"){
  initMonths();
  autoDate();
  render();
  showMain();
}else{
  showLogin();
}
</script>

</body>
</html>
