<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Duty Register Final</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#eef2f7;font-family:system-ui}
.card{max-width:1200px;margin:20px auto;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.15)}
.hidden{display:none}
.table-box{max-height:320px;overflow:auto}
.secret{background:#f1f1f1;padding:10px;border-radius:8px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
<h4 class="text-center">üîê Login</h4>

<div class="secret mb-3">
<input id="year" type="number" class="form-control mb-2" placeholder="Secret Year (1995)">
<button class="btn btn-secondary w-100" onclick="secret()">Secret Option</button>
<div id="secretBox" class="hidden mt-2 text-danger">
User: <b>admin</b><br>Password: <b>12345</b>
</div>
</div>

<input id="uid" class="form-control mb-2" placeholder="User ID">
<input id="pwd" type="password" class="form-control mb-2" placeholder="Password">
<button class="btn btn-primary w-100" onclick="login()">Login</button>
</div>


<!-- APP -->
<div id="app" class="card hidden">

<div class="d-flex justify-content-between">
<b>‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</b>
<button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
</div>

<h5 class="text-center mt-2">‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä</h5>

<form id="form" class="row g-2">

<input required id="company" class="form-control col-md-3" placeholder="‡§ï‡§Ç‡§™‡§®‡•Ä / ‡§∏‡•ç‡§•‡§æ‡§®">
<input required type="date" id="date" class="form-control col-md-2">

<select id="shift" class="form-control col-md-2">
<option>‡§¶‡§ø‡§®</option>
<option>‡§∞‡§æ‡§§</option>
</select>

<input type="time" id="start" class="form-control col-md-2">
<input type="time" id="end" class="form-control col-md-2">
<input id="work" class="form-control col-md-3" placeholder="‡§ï‡§æ‡§Æ / ‡§®‡•ã‡§ü‡•ç‡§∏">

<div class="col-md-3">
Font <input type="color" id="fc">
BG <input type="color" id="bc">
</div>

<button class="btn btn-success col-md-2">Save</button>
</form>

<hr>

<div class="d-flex justify-content-between">

<select id="month" class="form-select w-auto" onchange="loadData()">
<option value="">‡§∏‡§≠‡•Ä ‡§Æ‡§π‡•Ä‡§®‡•á</option>
<option value="01">January</option><option value="02">February</option>
<option value="03">March</option><option value="04">April</option>
<option value="05">May</option><option value="06">June</option>
<option value="07">July</option><option value="08">August</option>
<option value="09">September</option><option value="10">October</option>
<option value="11">November</option><option value="12">December</option>
</select>

<input id="search" class="form-control w-25" placeholder="Search" onkeyup="loadData()">

<div>
<button onclick="downloadCSV()" class="btn btn-success btn-sm">CSV</button>
<button onclick="downloadCSV()" class="btn btn-primary btn-sm">Excel</button>
<button onclick="window.print()" class="btn btn-danger btn-sm">PDF</button>
</div>

</div>

<div class="table-box mt-2">
<table class="table table-bordered table-sm">
<thead class="table-light">
<tr>
<th>‡§ï‡§Ç‡§™‡§®‡•Ä</th>
<th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
<th>‡§¶‡§ø‡§®</th>
<th>‡§∂‡§ø‡§´‡•ç‡§ü</th>
<th>‡§∏‡§Æ‡§Ø</th>
<th>‡§ï‡§æ‡§Æ</th>
<th>‡§ò‡§Ç‡§ü‡•á</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div class="d-flex justify-content-between">
<div>Total Hours: <b id="total">0</b></div>
<div>Total Entries: <b id="count">0</b></div>
</div>

</div>

<script>

const USER="admin",PASS="12345";
let editIndex=-1;

function secret(){
 if(year.value==1995) secretBox.classList.remove("hidden");
}

function login(){
 if(uid.value==USER && pwd.value==PASS){
  localStorage.setItem("login",1);
  show();
 }else alert("Wrong Login");
}

function logout(){
 localStorage.clear();
 location.reload();
}

function show(){
 loginPage.classList.add("hidden");
 app.classList.remove("hidden");
 loadData();
}

if(localStorage.getItem("login")) show();

function dayName(d){
 return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(d).getDay()];
}

function hours(a,b){
 let s=new Date("1970-1-1 "+a);
 let e=new Date("1970-1-1 "+b);
 if(e<s) e.setDate(e.getDate()+1);
 return ((e-s)/3600000).toFixed(2);
}

form.onsubmit=e=>{
 e.preventDefault();

 let data=JSON.parse(localStorage.getItem("duty")||"[]");

 let obj={
  company:company.value,
  date:date.value,
  shift:shift.value,
  start:start.value,
  end:end.value,
  work:work.value,
  fc:fc.value,
  bc:bc.value
 };

 if(editIndex>=0){
  data[editIndex]=obj;
  editIndex=-1;
 }else data.push(obj);

 localStorage.setItem("duty",JSON.stringify(data));
 form.reset();
 loadData();
};

function loadData(){

 let data=JSON.parse(localStorage.getItem("duty")||"[]");
 let m=month.value;
 let s=search.value.toLowerCase();

 tbody.innerHTML="";
 let total=0,countEntry=0;

 data.sort((a,b)=>new Date(a.date)-new Date(b.date));

 data.forEach((x,i)=>{

  if(m && x.date.substr(5,2)!=m) return;
  if(s && !(x.company+x.work).toLowerCase().includes(s)) return;

  let h=parseFloat(hours(x.start,x.end));
  total+=h;
  countEntry++;

  let tr=document.createElement("tr");
  tr.style.color=x.fc;
  tr.style.background=x.bc;

  tr.innerHTML=`
  <td>${x.company}</td>
  <td>${new Date(x.date).toLocaleDateString('en-GB')}</td>
  <td>${dayName(x.date)}</td>
  <td>${x.shift}</td>
  <td>${x.start}-${x.end}</td>
  <td>${x.work}</td>
  <td>${h.toFixed(2)}</td>
  <td>
  <button class="btn btn-warning btn-sm" onclick="editRow(${i})">Edit</button>
  <button class="btn btn-danger btn-sm" onclick="deleteRow(${i})">Delete</button>
  </td>`;

  tbody.appendChild(tr);
 });

 totalEl.innerText=total.toFixed(2);
 count.innerText=countEntry;
}

const totalEl=document.getElementById("total");

function editRow(i){
 let d=JSON.parse(localStorage.getItem("duty"))[i];
 company.value=d.company;
 date.value=d.date;
 shift.value=d.shift;
 start.value=d.start;
 end.value=d.end;
 work.value=d.work;
 fc.value=d.fc;
 bc.value=d.bc;
 editIndex=i;
}

function deleteRow(i){
 if(confirm("Delete this entry?")){
  let d=JSON.parse(localStorage.getItem("duty"));
  d.splice(i,1);
  localStorage.setItem("duty",JSON.stringify(d));
  loadData();
 }
}

function downloadCSV(){
 let rows=[...tbody.rows].map(r=>[...r.cells].slice(0,7).map(c=>c.innerText).join(",")).join("\n");
 let a=document.createElement("a");
 a.href="data:text/csv;charset=utf-8,"+encodeURI(rows);
 a.download="duty.csv";
 a.click();
}

</script>

</body>
</html>
