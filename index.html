<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Attendance App</title>

<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b4d2e;
}
.card{
  max-width:520px;
  margin:20px auto;
  background:#fff;
  padding:15px;
  border-radius:10px;
}
.hidden{display:none}
input,select,button{
  width:100%;
  padding:8px;
  margin:5px 0;
}
button{
  background:#0b4d2e;
  color:#fff;
  border:none;
  border-radius:5px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}
.edit{background:orange}
.del{background:red}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.logo{
  font-size:40px;
  text-align:center;
}
</style>
</head>

<body>

<!-- LOGIN PAGE -->
<div id="login" class="card">
  <div class="logo">üßë‚Äçüíº</div>
  <h3 style="text-align:center">Admin Login</h3>

  <select>
    <option><b>ADMIN</b></option>
  </select>

  <input type="password" id="password" placeholder="Password">

  <button onclick="login()">Login</button>
</div>

<!-- APP PAGE -->
<div id="app" class="hidden">

<div class="card">
  <div class="top">
    <b>Attendance Panel</b>
    <div>
      ‚öôÔ∏è
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <select id="month">
    <option>January 2026</option>
    <option>February 2026</option>
    <option>March 2026</option>
  </select>

  <input type="number" id="date" placeholder="Date (1-31)">

  <select id="day">
    <option value="">Day</option>
    <option>P</option>
    <option>A</option>
  </select>

  <select id="night">
    <option value="">Night</option>
    <option>P</option>
    <option>A</option>
  </select>

  <select id="post" onchange="checkPost()">
    <option>ETP</option>
    <option>AMBER</option>
    <option>DENIM</option>
    <option value="add">+ Add Post</option>
  </select>

  <select id="sign">
    <option>Ravi</option>
  </select>

  <input type="color" id="color">

  <button onclick="saveEntry()">Save Entry</button>
  <button onclick="downloadCSV()">Download CSV</button>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Day</th>
        <th>Night</th>
        <th>Post</th>
        <th>Sign</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="dayTotal">0</th>
        <th id="nightTotal">0</th>
        <th colspan="3"></th>
      </tr>
    </tfoot>
  </table>

</div>
</div>

<script>
const DEFAULT_PASSWORD = "7024";
let data = JSON.parse(localStorage.getItem("attendanceData")) || [];
let editIndex = -1;

function login(){
  if(password.value === DEFAULT_PASSWORD){
    login.classList.add("hidden");
    app.classList.remove("hidden");
    render();
  }else{
    alert("Wrong Password");
  }
}

function logout(){
  app.classList.add("hidden");
  login.classList.remove("hidden");
}

function checkPost(){
  if(post.value === "add"){
    let p = prompt("Enter new post");
    if(p){
      let opt = document.createElement("option");
      opt.text = p;
      post.add(opt, post.length-1);
      post.value = p;
    }
  }
}

function saveEntry(){
  let obj = {
    month: month.value,
    date: Number(date.value),
    day: day.value,
    night: night.value,
    post: post.value,
    sign: sign.value,
    color: color.value
  };

  if(editIndex >= 0){
    data[editIndex] = obj;
    editIndex = -1;
  }else{
    data.push(obj);
  }

  localStorage.setItem("attendanceData", JSON.stringify(data));
  render();
}

function render(){
  rows.innerHTML = "";
  let d = 0, n = 0;

  data
  .filter(e => e.month === month.value)
  .sort((a,b)=>a.date-b.date)
  .forEach((e,i)=>{
    if(e.day==="P") d++;
    if(e.night==="P") n++;

    rows.innerHTML += `
    <tr style="color:${e.color}">
      <td>${e.date}</td>
      <td>${e.day}</td>
      <td>${e.night}</td>
      <td>${e.post}</td>
      <td>${e.sign}</td>
      <td>
        <button class="edit" onclick="editEntry(${i})">Edit</button>
        <button class="del" onclick="deleteEntry(${i})">Del</button>
      </td>
    </tr>`;
  });

  dayTotal.innerText = d;
  nightTotal.innerText = n;
}

function editEntry(i){
  let e = data[i];
  editIndex = i;
  date.value = e.date;
  day.value = e.day;
  night.value = e.night;
  post.value = e.post;
  color.value = e.color;
}

function deleteEntry(i){
  if(confirm("Delete this entry?")){
    data.splice(i,1);
    localStorage.setItem("attendanceData", JSON.stringify(data));
    render();
  }
}

function downloadCSV(){
  let csv = "Month,Date,Day,Night,Post,Sign\n";
  data.forEach(e=>{
    csv += `${e.month},${e.date},${e.day},${e.night},${e.post},${e.sign}\n`;
  });

  let a = document.createElement("a");
  a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  a.download = "attendance.csv";
  a.click();
}

/* PWA */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
  </html>
