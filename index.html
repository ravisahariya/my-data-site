<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Duty Register Final Pro Max</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#eef2f7;font-family:system-ui}
.card{max-width:1300px;margin:20px auto;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.15)}
.hidden{display:none}
.table-box{max-height:330px;overflow:auto}

table{table-layout:fixed;width:100%}
th,td{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:14px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">

<h4 class="text-center">üîê Login</h4>

<button class="btn btn-secondary w-100 mb-3" onclick="secret()">Secret Option</button>

<div id="secretBox" class="hidden text-danger mb-2">
User: admin<br>Password: 12345
</div>

<input id="uid" class="form-control mb-2" placeholder="User ID">
<input id="pwd" type="password" class="form-control mb-2" placeholder="Password">

<button class="btn btn-primary w-100" onclick="login()">Login</button>

</div>



<!-- APP -->
<div id="app" class="card hidden">

<div class="d-flex justify-content-between">
<b>‡§°‡•ç‡§Ø‡•Ç‡§ü‡•Ä ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</b>
<button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
</div>


<!-- ENTRY -->
<form id="form" class="row g-2 mt-3">

<input required id="company" class="form-control col-md-3" placeholder="‡§ï‡§Ç‡§™‡§®‡•Ä / ‡§∏‡•ç‡§•‡§æ‡§®">
<input required type="date" id="date" class="form-control col-md-2">

<select id="shift" class="form-control col-md-2">
<option>‡§¶‡§ø‡§®</option>
<option>‡§∞‡§æ‡§§</option>
</select>

<input type="time" id="start" class="form-control col-md-2">
<input type="time" id="end" class="form-control col-md-2">

<input id="work" class="form-control col-md-3" placeholder="‡§ï‡§æ‡§Æ / ‡§®‡•ã‡§ü‡•ç‡§∏">

<div class="col-md-3">
Font <input type="color" id="fc" value="#000000">
BG <input type="color" id="bc" value="#ffffff">
</div>

<button class="btn btn-success col-md-2">Save</button>

</form>

<hr>


<!-- FILTER -->
<div class="d-flex justify-content-between mb-2">

<select id="month" class="form-select w-auto" onchange="loadData()">
<option value="">‡§∏‡§≠‡•Ä ‡§Æ‡§π‡•Ä‡§®‡•á</option>
<option value="01">Jan</option><option value="02">Feb</option>
<option value="03">Mar</option><option value="04">Apr</option>
<option value="05">May</option><option value="06">Jun</option>
<option value="07">Jul</option><option value="08">Aug</option>
<option value="09">Sep</option><option value="10">Oct</option>
<option value="11">Nov</option><option value="12">Dec</option>
</select>

<input id="search" class="form-control w-25" placeholder="Search" onkeyup="loadData()">

<div>
<button onclick="downloadCSV()" class="btn btn-success btn-sm">CSV</button>
<button onclick="downloadCSV()" class="btn btn-primary btn-sm">Excel</button>
<button onclick="window.print()" class="btn btn-danger btn-sm">PDF</button>
</div>

</div>



<!-- TABLE -->
<div class="table-box">
<table class="table table-bordered table-sm">

<thead class="table-light">
<tr>
<th>‡§ï‡§Ç‡§™‡§®‡•Ä</th>
<th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
<th>‡§¶‡§ø‡§®</th>
<th>‡§∂‡§ø‡§´‡•ç‡§ü</th>
<th>‡§∏‡§Æ‡§Ø</th>
<th>‡§ï‡§æ‡§Æ</th>
<th>‡§ò‡§Ç‡§ü‡•á</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

</table>
</div>

<div class="d-flex justify-content-between">
<div>Total Hours: <b id="total">0</b></div>
<div>Total Entries: <b id="count">0</b></div>
</div>

</div>



<script>

const USER="admin",PASS="12345";
let editIndex=-1;

/* LOGIN */
function secret(){
 let y=prompt("Enter Secret Year");
 if(y==1995) secretBox.classList.remove("hidden");
}

function login(){
 if(uid.value==USER && pwd.value==PASS){
  localStorage.setItem("login",1);
  show();
 }
}

function logout(){
 localStorage.clear();
 location.reload();
}

function show(){
 loginPage.classList.add("hidden");
 app.classList.remove("hidden");
 loadData();
}

if(localStorage.getItem("login")) show();



/* HELPERS */
function dayName(d){
 return ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(d).getDay()];
}

function hours(a,b){
 let s=new Date("1970-1-1 "+a);
 let e=new Date("1970-1-1 "+b);
 if(e<s) e.setDate(e.getDate()+1);
 return ((e-s)/3600000).toFixed(2);
}



/* SAVE */
form.onsubmit=function(e){

 e.preventDefault();

 let data=JSON.parse(localStorage.getItem("duty")||"[]");

 let obj={
  company:company.value,
  date:date.value,
  shift:shift.value,
  start:start.value,
  end:end.value,
  work:work.value,
  fc:fc.value,
  bc:bc.value
 };

 if(editIndex>=0){
  data[editIndex]=obj;
  editIndex=-1;
 }else{
  data.push(obj);
 }

 localStorage.setItem("duty",JSON.stringify(data));
 form.reset();
 loadData();
};



/* LOAD + DUPLICATE HIGHLIGHT */
function loadData(){

 let data=JSON.parse(localStorage.getItem("duty")||"[]");

 let m=month.value;
 let s=search.value.toLowerCase();

 tbody.innerHTML="";
 let totalH=0,countE=0;

 data.sort((a,b)=>new Date(a.date)-new Date(b.date));

 /* duplicate date count */
 let dateCount={};
 data.forEach(x=>dateCount[x.date]=(dateCount[x.date]||0)+1);

 data.forEach((x,i)=>{

  if(m && x.date.substr(5,2)!=m) return;
  if(s && !(x.company+x.work).toLowerCase().includes(s)) return;

  let h=parseFloat(hours(x.start,x.end));
  totalH+=h; countE++;

  let tr=document.createElement("tr");

  tr.style.color=x.fc;

  /* ‚≠ê duplicate highlight ‚≠ê */
  if(dateCount[x.date] > 1){
   tr.style.backgroundColor="#ffe08a";
  }else{
   tr.style.backgroundColor=x.bc;
  }

  tr.innerHTML=`
  <td>${x.company}</td>
  <td>${new Date(x.date).toLocaleDateString('en-GB')}</td>
  <td>${dayName(x.date)}</td>
  <td>${x.shift}</td>
  <td>${x.start}-${x.end}</td>
  <td>${x.work}</td>
  <td>${h}</td>
  <td>
  <button onclick="editRow(${i})" class="btn btn-warning btn-sm">Edit</button>
  <button onclick="delRow(${i})" class="btn btn-danger btn-sm">Delete</button>
  </td>`;

  tbody.appendChild(tr);

 });

 total.innerText=totalH.toFixed(2);
 count.innerText=countE;
}



/* EDIT */
function editRow(i){
 let d=JSON.parse(localStorage.getItem("duty"))[i];
 Object.keys(d).forEach(k=>window[k].value=d[k]);
 editIndex=i;
}


/* DELETE */
function delRow(i){
 if(confirm("Delete this entry?")){
  let d=JSON.parse(localStorage.getItem("duty"));
  d.splice(i,1);
  localStorage.setItem("duty",JSON.stringify(d));
  loadData();
 }
}


/* CSV */
function downloadCSV(){
 let rows=[...tbody.rows].map(r=>[...r.cells].slice(0,7).map(c=>c.innerText).join(",")).join("\n");
 let a=document.createElement("a");
 a.href="data:text/csv;charset=utf-8,"+encodeURI(rows);
 a.download="duty.csv";
 a.click();
}

</script>

</body>
 </html>
