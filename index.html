<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Attendance Register</title>

<style>

body{
  margin:0;
  font-family:Arial;
  background:#f2f2f2;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* FORM */
.form{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  padding:8px;
}

input,select,button{
  padding:8px;
  font-size:14px;
}

button{
  background:#4CAF50;
  color:white;
  border:none;
}

/* TABLE */
.table-box{
  flex:1;
  overflow:auto;
  background:white;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}

th{
  background:#ffd9d9;
  position:sticky;
  top:0;
}

.total{
  background:#ffeaa7;
  font-weight:bold;
}

</style>
</head>


<body>

<h3 style="text-align:center">üìã Attendance Register</h3>

<div class="form">
<input type="date" id="date">
<input type="time" id="inTime">
<input type="time" id="outTime">

<select id="post">
<option>ETP</option>
<option>BOARD 2</option>
<option>COE</option>
<option>ACL</option>
<option>BEBRIG</option>
</select>

<button onclick="save()">SAVE</button>
</div>


<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th>
<th>In</th>
<th>Out</th>
<th>Hours</th>
<th>Post</th>
<th>Edit</th>
<th>Delete</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

<tfoot>
<tr class="total">
<td colspan="3">Grand Total</td>
<td id="total">0</td>
<td colspan="3"></td>
</tr>
</tfoot>

</table>
</div>


<script>

let data = JSON.parse(localStorage.getItem("attData")) || [];
let editIndex = -1;

/* SAVE ENTRY */
function save(){

 let d=date.value;
 let i=inTime.value;
 let o=outTime.value;
 let p=post.value;

 if(!d||!i||!o){
   alert("Fill all fields");
   return;
 }

 let h=calcHours(i,o);

 if(editIndex>=0){
   data[editIndex]={d,i,o,h,p};
   editIndex=-1;
 }
 else{
   data.push({d,i,o,h,p});
 }

 localStorage.setItem("attData",JSON.stringify(data));

 render();   /* ‚≠ê MOST IMPORTANT FIX */

 clearForm();
}


/* HOURS CALC */
function calcHours(a,b){
 let x=new Date("2000-01-01 "+a);
 let y=new Date("2000-01-01 "+b);

 if(y<x) y.setDate(y.getDate()+1);

 return ((y-x)/3600000).toFixed(2);
}


/* RENDER TABLE */
function render(){

 let tbody=document.getElementById("tbody");
 tbody.innerHTML="";

 let totalH=0;

 data.forEach((r,i)=>{

  totalH+=parseFloat(r.h);

  let tr=document.createElement("tr");

  tr.innerHTML=`
  <td>${r.d}</td>
  <td>${r.i}</td>
  <td>${r.o}</td>
  <td>${r.h}</td>
  <td>${r.p}</td>
  <td><button onclick="edit(${i})">‚úèÔ∏è</button></td>
  <td><button onclick="del(${i})">‚ùå</button></td>
  `;

  tbody.appendChild(tr);

 });

 document.getElementById("total").innerText=totalH.toFixed(2);
}


/* EDIT */
function edit(i){
 let r=data[i];
 date.value=r.d;
 inTime.value=r.i;
 outTime.value=r.o;
 post.value=r.p;
 editIndex=i;
}


/* DELETE */
function del(i){
 data.splice(i,1);
 localStorage.setItem("attData",JSON.stringify(data));
 render();
}


/* CLEAR */
function clearForm(){
 date.value="";
 inTime.value="";
 outTime.value="";
}


/* LOAD ON START */
render();

</script>

</body>
</html>
