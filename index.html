<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Duty + Expense System</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body{
 background:#eef2f7;
 font-family:system-ui;
}

.card{
 max-width:1300px;
 margin:25px auto;
 padding:20px;
 border-radius:12px;
 box-shadow:0 8px 20px rgba(0,0,0,.15);
 background:#fff;
}

.login{max-width:380px;margin-top:80px}

.hidden{display:none}

.table-box{
 max-height:330px;
 overflow:auto;
}

.big{height:50px}

</style>
</head>

<body>


<!-- ================= LOGIN ================= -->

<div id="loginPage" class="card login text-center">

<h3>üîê Login</h3>

<button onclick="secret()" class="btn btn-secondary w-100 my-2">Secret</button>

<div id="secretBox" class="hidden text-danger">
Admin / 8888<br>
Ravi / 7024
</div>

<select id="uid" class="form-select my-2">
<option value="admin">Admin</option>
<option value="ravi">Ravi</option>
</select>

<input id="pwd" type="password" class="form-control mb-3" placeholder="Password">

<button onclick="login()" class="btn btn-primary w-100 big">Login</button>

</div>



<!-- ================= ADMIN DUTY DASHBOARD ================= -->

<div id="dutyDash" class="card hidden">

<h4>üë®‚Äçüíº Duty Entry Form</h4>
<button onclick="logout()" class="btn btn-danger btn-sm float-end">Logout</button>

<div class="row">

<!-- LEFT FORM -->
<div class="col-md-5">

<form id="dutyForm" class="row g-2">

<input id="emp" required class="form-control" placeholder="Employee Name">

<input id="company" required class="form-control" placeholder="Company Name">

<input type="date" id="date" required class="form-control">

<select id="shift" class="form-control">
<option>Day</option>
<option>Night</option>
</select>

<div class="d-flex gap-2">
<input type="time" id="start" class="form-control">
<input type="time" id="end" class="form-control">
</div>

<textarea id="remark" class="form-control" placeholder="Remarks"></textarea>

<div>
Font <input type="color" id="fc">
BG <input type="color" id="bc">
</div>

<button class="btn btn-success big">Save Entry</button>

</form>

</div>



<!-- RIGHT TABLE -->
<div class="col-md-7">

<h5>üìã Duty Record</h5>

<div class="table-box">
<table class="table table-bordered table-sm">

<thead class="table-light">
<tr>
<th>Date</th>
<th>Shift</th>
<th>Time</th>
<th>Hours</th>
<th>Company</th>
<th>Remark</th>
<th>Del</th>
</tr>
</thead>

<tbody id="dutyBody"></tbody>

</table>
</div>

<b>Total Hours: <span id="totalH">0</span></b>

</div>

</div>

</div>



<!-- ================= RAVI EXPENSE ================= -->

<div id="expenseDash" class="card hidden">

<h4>üí∞ Expense Dashboard</h4>
<button onclick="logout()" class="btn btn-danger btn-sm float-end">Logout</button>

<form id="expForm" class="row g-2">

<input id="ename" required class="form-control col-md-3" placeholder="Name">
<input type="date" id="edate" required class="form-control col-md-2">
<input type="number" id="amount" required class="form-control col-md-2" placeholder="‚Çπ">
<button class="btn btn-success col-md-2">Save</button>

</form>

<hr>

<div class="table-box">
<table class="table table-bordered">
<tbody id="expBody"></tbody>
</table>
</div>

<b>Daily ‚Çπ: <span id="daily">0</span> | Monthly ‚Çπ: <span id="monthly">0</span></b>

</div>



<script>

const USERS={admin:"8888",ravi:"7024"};


/* LOGIN */

function secret(){
 if(prompt("Year?")==1995) secretBox.classList.remove("hidden");
}

function login(){
 if(USERS[uid.value]===pwd.value){
  localStorage.setItem("user",uid.value);
  show();
 }else alert("Wrong password");
}

function logout(){
 localStorage.clear();
 location.reload();
}

function show(){

 loginPage.classList.add("hidden");

 let u=localStorage.getItem("user");

 if(u==="admin"){
  dutyDash.classList.remove("hidden");
  loadDuty();
 }

 if(u==="ravi"){
  expenseDash.classList.remove("hidden");
  loadExpense();
 }
}

if(localStorage.getItem("user")) show();



/* ================= DUTY ================= */

function dutyKey(){return "duty_admin"}

function hours(a,b){
 let s=new Date("1970-1-1 "+a);
 let e=new Date("1970-1-1 "+b);
 if(e<s)e.setDate(e.getDate()+1);
 return ((e-s)/3600000).toFixed(2);
}

dutyForm.onsubmit=function(e){

 e.preventDefault();

 let d=JSON.parse(localStorage.getItem(dutyKey())||"[]");

 d.push({
  date:date.value,
  shift:shift.value,
  start:start.value,
  end:end.value,
  company:company.value,
  remark:remark.value,
  fc:fc.value,
  bc:bc.value
 });

 localStorage.setItem(dutyKey(),JSON.stringify(d));
 dutyForm.reset();
 loadDuty();
}

function loadDuty(){

 let d=JSON.parse(localStorage.getItem(dutyKey())||"[]");

 dutyBody.innerHTML="";
 let total=0;

 d.forEach((x,i)=>{

  let h=parseFloat(hours(x.start,x.end));
  total+=h;

  let tr=document.createElement("tr");

  tr.style.color=x.fc;
  tr.style.background=x.bc;

  tr.innerHTML=`
  <td>${x.date}</td>
  <td>${x.shift}</td>
  <td>${x.start}-${x.end}</td>
  <td>${h}</td>
  <td>${x.company}</td>
  <td>${x.remark}</td>
  <td><button onclick="delDuty(${i})">X</button></td>
  `;

  dutyBody.appendChild(tr);

 });

 totalH.innerText=total.toFixed(2);
}

function delDuty(i){
 let d=JSON.parse(localStorage.getItem(dutyKey()));
 d.splice(i,1);
 localStorage.setItem(dutyKey(),JSON.stringify(d));
 loadDuty();
}



/* ================= EXPENSE ================= */

function expKey(){return "expense_ravi"}

expForm.onsubmit=function(e){

 e.preventDefault();

 let d=JSON.parse(localStorage.getItem(expKey())||"[]");

 d.push({date:edate.value,name:ename.value,amount:+amount.value});

 localStorage.setItem(expKey(),JSON.stringify(d));

 expForm.reset();
 loadExpense();
}

function loadExpense(){

 let d=JSON.parse(localStorage.getItem(expKey())||"[]");

 expBody.innerHTML="";

 let today=new Date().toISOString().substr(0,10);
 let month=today.substr(0,7);

 let daily=0,monthly=0;

 d.forEach((x,i)=>{

  if(x.date===today) daily+=x.amount;
  if(x.date.substr(0,7)===month) monthly+=x.amount;

  expBody.innerHTML+=`
  <tr>
  <td>${x.date}</td>
  <td>${x.name}</td>
  <td>${x.amount}</td>
  <td><button onclick="delExp(${i})">X</button></td>
  </tr>`;
 });

 daily.innerText=daily;
 monthly.innerText=monthly;
}

function delExp(i){
 let d=JSON.parse(localStorage.getItem(expKey()));
 d.splice(i,1);
 localStorage.setItem(expKey(),JSON.stringify(d));
 loadExpense();
}

</script>

</body>
 </html>
