<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Attendance</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f5132;
}
.card{
  background:#fff;
  max-width:420px;
  margin:40px auto;
  padding:20px;
  border-radius:10px;
}
h2{text-align:center}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
}
button{
  background:#0f5132;
  color:#fff;
  border:none;
  border-radius:5px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}
th{background:#eee}
.hidden{display:none}

.settings{
  position:absolute;
  right:15px;
  top:15px;
  font-size:20px;
  cursor:pointer;
}

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.popup .box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:250px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
  <h2>üë§ Admin Login</h2>

  <select>
    <option><b>ADMIN</b></option>
  </select>

  <input type="password" id="password" placeholder="Password">

  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appPage" class="card hidden">
  <div class="settings" onclick="openSettings()">‚öôÔ∏è</div>
  <h2>Register + Attendance</h2>

  <select id="monthSelect">
    <option value="">Select Month</option>
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <input type="date" id="date">

  <select id="shift">
    <option value="">Day / Night</option>
    <option>Day</option>
    <option>Night</option>
  </select>

  <select id="post">
    <option value="">Post</option>
    <option>COE</option><option>ABEER</option><option>DENIEM</option>
    <option>ETP</option><option>ACL</option><option>BORD2</option>
    <option>CASUAL</option><option>CCTV</option>
  </select>

  <input type="color" id="rowColor" value="#ffffff">

  <button onclick="saveEntry()">Save Entry</button>

  <table>
    <thead>
      <tr>
        <th>Date</th><th>Day</th><th>Night</th>
        <th>Post</th><th>Sign</th><th>Edit</th><th>Del</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="dayTotal">0</th>
        <th id="nightTotal">0</th>
        <th colspan="3"></th>
      </tr>
    </tfoot>
  </table>

  <button onclick="downloadCSV()">Download CSV</button>
</div>

<!-- SETTINGS -->
<div id="settingsPopup" class="popup hidden">
  <div class="box">
    <h3>Settings</h3>
    <button onclick="logout()">Logout</button>
    <button onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
const loginPage=document.getElementById("loginPage");
const appPage=document.getElementById("appPage");
const settingsPopup=document.getElementById("settingsPopup");
const tableBody=document.getElementById("tableBody");
let data=JSON.parse(localStorage.getItem("attendance")||"[]");

if(localStorage.getItem("login")==="yes"){
  loginPage.classList.add("hidden");
  appPage.classList.remove("hidden");
  render();
}

function login(){
  if(password.value==="7024"){
    localStorage.setItem("login","yes");
    loginPage.classList.add("hidden");
    appPage.classList.remove("hidden");
  }else alert("Wrong Password");
}

function logout(){
  localStorage.removeItem("login");
  settingsPopup.classList.add("hidden");
  appPage.classList.add("hidden");
  loginPage.classList.remove("hidden");
}

function openSettings(){settingsPopup.classList.remove("hidden")}
function closeSettings(){settingsPopup.classList.add("hidden")}

function saveEntry(){
  if(!date.value){alert("Date required");return}
  data.push({
    month:monthSelect.value,
    date:date.value,
    shift:shift.value,
    post:post.value,
    sign:"Ravi",
    color:rowColor.value
  });
  data.sort((a,b)=>a.date.localeCompare(b.date));
  localStorage.setItem("attendance",JSON.stringify(data));
  render();
}

function render(){
  tableBody.innerHTML="";
  let day=0,night=0;
  data.filter(d=>d.month===monthSelect.value||monthSelect.value==="")
  .forEach((d,i)=>{
    if(d.shift==="Day")day++;
    if(d.shift==="Night")night++;
    tableBody.innerHTML+=`
      <tr style="background:${d.color}">
        <td>${d.date}</td>
        <td>${d.shift==="Day"?"P":""}</td>
        <td>${d.shift==="Night"?"P":""}</td>
        <td>${d.post}</td>
        <td>${d.sign}</td>
        <td><button onclick="editRow(${i})">‚úèÔ∏è</button></td>
        <td><button onclick="delRow(${i})">üóë</button></td>
      </tr>`;
  });
  dayTotal.innerText=day;
  nightTotal.innerText=night;
}

function delRow(i){
  if(confirm("Delete entry?")){
    data.splice(i,1);
    localStorage.setItem("attendance",JSON.stringify(data));
    render();
  }
}

function editRow(i){
  date.value=data[i].date;
  shift.value=data[i].shift;
  post.value=data[i].post;
  rowColor.value=data[i].color;
  data.splice(i,1);
}

function downloadCSV(){
  let csv="Date,Shift,Post,Sign\n";
  data.forEach(d=>{
    csv+=`${d.date},${d.shift},${d.post},${d.sign}\n`;
  });
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="attendance.csv";
  a.click();
}
</script>

</body>
</html>
