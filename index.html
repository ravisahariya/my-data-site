<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Duty & Expense Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body{
 background:linear-gradient(135deg,#4e73df,#1cc88a);
 font-family:system-ui;
 min-height:100vh;
}

/* LOGIN */
.login-card{
 max-width:420px;
 margin:80px auto;
 padding:35px;
 border-radius:18px;
 background:#fff;
 box-shadow:0 12px 30px rgba(0,0,0,.25);
}

/* DASHBOARD */
.dashboard{
 max-width:1400px;
 margin:20px auto;
 padding:20px;
 border-radius:18px;
 background:#fff;
 box-shadow:0 12px 30px rgba(0,0,0,.25);
}

.hidden{display:none}

.table-box{
 max-height:350px;
 overflow:auto;
}

table{
 table-layout:fixed;
 width:100%;
}

th,td{
 white-space:nowrap;
 overflow:hidden;
 text-overflow:ellipsis;
 font-size:14px;
}

.big-btn{
 height:55px;
 font-size:18px;
}

</style>
</head>

<body>


<!-- ================= LOGIN ================= -->

<div id="loginPage" class="login-card text-center">

<h3 class="mb-4">üîê Login</h3>

<button class="btn btn-secondary mb-3 w-100" onclick="secret()">Secret</button>

<div id="secretBox" class="hidden text-danger mb-3">
Admin / 8888<br>
Ravi / 7024
</div>

<select id="uid" class="form-select mb-3">
<option value="admin">Admin</option>
<option value="ravi">Ravi</option>
</select>

<input id="pwd" type="password" class="form-control mb-3" placeholder="Password">

<button onclick="login()" class="btn btn-primary w-100 big-btn">Login</button>

</div>



<!-- ================= DASHBOARD ================= -->

<div id="app" class="dashboard hidden">

<div class="d-flex justify-content-between align-items-center mb-3">
<h4>üìã Duty & Expense Dashboard (<span id="userShow"></span>)</h4>
<button class="btn btn-danger" onclick="logout()">Logout</button>
</div>


<!-- ENTRY -->
<form id="form" class="row g-2">

<input required id="company" class="form-control col-md-3" placeholder="‡§ï‡§Ç‡§™‡§®‡•Ä / ‡§ñ‡§∞‡•ç‡§ö‡§æ ‡§®‡§æ‡§Æ">

<input required type="date" id="date" class="form-control col-md-2">

<select id="shift" class="form-control col-md-2">
<option>‡§¶‡§ø‡§®</option>
<option>‡§∞‡§æ‡§§</option>
<option>‡§ñ‡§∞‡•ç‡§ö‡§æ</option>
</select>

<input type="time" id="start" class="form-control col-md-2">
<input type="time" id="end" class="form-control col-md-2">

<input id="work" class="form-control col-md-3" placeholder="‡§ï‡§æ‡§Æ / ‡§®‡•ã‡§ü‡•ç‡§∏">

<div class="col-md-3">
Font <input type="color" id="fc" value="#000000">
BG <input type="color" id="bc" value="#ffffff">
</div>

<button class="btn btn-success col-md-2 big-btn">Save</button>

</form>

<hr>


<!-- TABLE -->
<div class="table-box">

<table class="table table-bordered table-sm">

<thead class="table-light">
<tr>
<th>Name</th>
<th>Date</th>
<th>Day</th>
<th>Type</th>
<th>Time</th>
<th>Note</th>
<th>Hours</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

</table>

</div>

<div class="d-flex justify-content-between mt-2">
<b>Total Hours: <span id="total">0</span></b>
<b>Total Entries: <span id="count">0</span></b>
</div>

</div>



<script>

const USERS={
 admin:"8888",
 ravi:"7024"
};

let currentUser="";
let editIndex=-1;


/* SECRET */
function secret(){
 let y=prompt("Enter Secret Year");
 if(y==1995) secretBox.classList.remove("hidden");
}


/* LOGIN */
function login(){

 let u=uid.value;
 let p=pwd.value;

 if(USERS[u]===p){
  currentUser=u;
  localStorage.setItem("loginUser",u);
  show();
 }else alert("Wrong Password");
}

function logout(){
 localStorage.clear();
 location.reload();
}

function show(){
 loginPage.classList.add("hidden");
 app.classList.remove("hidden");

 currentUser=localStorage.getItem("loginUser");
 userShow.innerText=currentUser;

 loadData();
}

if(localStorage.getItem("loginUser")) show();



/* HELPERS */

function key(){
 return "duty_"+currentUser;
}

function dayName(d){
 return ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(d).getDay()];
}

function hours(a,b){
 if(!a||!b) return 0;
 let s=new Date("1970-1-1 "+a);
 let e=new Date("1970-1-1 "+b);
 if(e<s) e.setDate(e.getDate()+1);
 return ((e-s)/3600000).toFixed(2);
}



/* SAVE */

form.onsubmit=function(e){

 e.preventDefault();

 let data=JSON.parse(localStorage.getItem(key())||"[]");

 let obj={
  company:company.value,
  date:date.value,
  shift:shift.value,
  start:start.value,
  end:end.value,
  work:work.value,
  fc:fc.value,
  bc:bc.value
 };

 if(editIndex>=0){
  data[editIndex]=obj;
  editIndex=-1;
 }else data.push(obj);

 localStorage.setItem(key(),JSON.stringify(data));

 form.reset();
 loadData();
};



/* LOAD */

function loadData(){

 let data=JSON.parse(localStorage.getItem(key())||"[]");

 tbody.innerHTML="";
 let totalH=0;

 let dateCount={};
 data.forEach(x=>dateCount[x.date]=(dateCount[x.date]||0)+1);

 data.forEach((x,i)=>{

  let h=parseFloat(hours(x.start,x.end));
  totalH+=h;

  let tr=document.createElement("tr");

  tr.style.color=x.fc;

  if(dateCount[x.date]>1) tr.style.background="#ffe08a";
  else tr.style.background=x.bc;

  tr.innerHTML=`
  <td>${x.company}</td>
  <td>${x.date}</td>
  <td>${dayName(x.date)}</td>
  <td>${x.shift}</td>
  <td>${x.start||""}-${x.end||""}</td>
  <td>${x.work}</td>
  <td>${h}</td>
  <td>
  <button onclick="delRow(${i})" class="btn btn-danger btn-sm">Delete</button>
  </td>`;

  tbody.appendChild(tr);

 });

 total.innerText=totalH.toFixed(2);
 count.innerText=data.length;
}


/* DELETE */

function delRow(i){
 if(confirm("Delete entry?")){
  let d=JSON.parse(localStorage.getItem(key()));
  d.splice(i,1);
  localStorage.setItem(key(),JSON.stringify(d));
  loadData();
 }
}

</script>

</body>
</html>
