<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Attendance Master Cloud</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}

/* LOGIN */
#loginPage{
height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(135deg,#5f72ff,#9b59b6)
}
.loginCard{
background:#fff;width:95%;max-width:520px;padding:55px;border-radius:25px;
text-align:center;box-shadow:0 20px 50px rgba(0,0,0,.35)
}
.loginCard h2{font-size:32px;margin-bottom:10px}
.loginCard input{width:100%;padding:16px;margin:10px 0;font-size:18px}
.loginCard button{width:100%;padding:14px;font-size:18px;margin-top:8px}

/* APP */
#app{display:none;height:100vh;flex-direction:column;background:#fff}

/* HEADER */
header{
background:#1565c0;color:#fff;padding:12px;font-size:20px;
display:flex;justify-content:space-between;align-items:center;
position:sticky;top:0;z-index:10
}
.logoutBtn{background:red;color:#fff;border:none;padding:8px 16px;font-size:16px}

/* ENTRY FORM */
#entryForm{background:#d9ecff;padding:10px}

/* TABLE */
.tableWrap{flex:1;overflow:auto}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#ffdede;position:sticky;top:0}
.night{background:#e3f2fd;color:blue}

/* FOOTER */
footer{
background:#ffcc00;padding:14px;font-size:18px;font-weight:bold;
position:sticky;bottom:0
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="loginCard">
    <h2>üîê Attendance Login</h2>
    <div id="clock"></div>
    <input id="user" placeholder="Username">
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="secret()">üîí Secret</button>
  </div>
</div>

<!-- APP -->
<div id="app">

<header>
  üìä ATTENDANCE MASTER DATA
  <button class="logoutBtn" onclick="logout()">Logout</button>
</header>

<div id="entryForm">
  üïí <span id="runClock"></span><br><br>
  <input type="date" id="date">
  <input type="time" id="inTime">
  <input type="time" id="outTime">
  <input id="post" placeholder="Post">
  BG <input type="color" id="bg" value="#ffffff">
  Font <input type="color" id="font" value="#000000">
  <button onclick="save()">Save</button>
  <select id="monthFilter" onchange="render()"></select>
  <button onclick="download()">Excel</button>
  <button onclick="window.print()">Print</button>
</div>

<div class="tableWrap">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th>
<th>Post</th><th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<footer>
Total Duty: <span id="duty">0</span> |
Total Hours: <span id="hours">0</span>
</footer>

</div>

<script>
/* CLOCK */
setInterval(()=>{
let t=new Date().toLocaleString();
clock.innerText=t; runClock.innerText=t;
},1000);

/* LOGIN */
const USERNAME="9823087";
const PASSWORD="7284";

function login(){
if(user.value===USERNAME && pass.value===PASSWORD){
sessionStorage.setItem("logged","1"); showApp();
}else alert("Wrong Username / Password");
}
function logout(){sessionStorage.removeItem("logged");location.reload();}
function showApp(){loginPage.style.display="none";app.style.display="flex";}
if(sessionStorage.getItem("logged")==="1") showApp();

/* SECRET */
function secret(){
if(prompt("Enter secret year")==="1995"){
alert("Username: "+USERNAME+"\nPassword: "+PASSWORD);
}
}

/* FIREBASE */
firebase.initializeApp({
apiKey:"AIzaSyD71mpolAsmejtU2icecQQcX07iCW_is0Y",
authDomain:"ravicardmaker.firebaseapp.com",
projectId:"ravicardmaker"
});
const db=firebase.firestore();
let data=[];

db.collection("attendance").onSnapshot(s=>{
data=[]; s.forEach(d=>data.push({id:d.id,...d.data()}));
render();
});

/* MONTH */
for(let i=1;i<=12;i++){
let o=document.createElement("option");
o.value=String(i).padStart(2,"0");
o.text=new Date(2026,i-1).toLocaleString('en',{month:'long'});
monthFilter.appendChild(o);
}
monthFilter.value=String(new Date().getMonth()+1).padStart(2,"0");

/* HOURS */
function calc(i,o){
let a=new Date("2000 "+i),b=new Date("2000 "+o);
if(b<a)b.setDate(b.getDate()+1);
return ((b-a)/3600000).toFixed(2);
}

/* SAVE */
function save(){
db.collection("attendance").add({
d:date.value,i:inTime.value,o:outTime.value,p:post.value,
bg:bg.value,font:font.value,h:calc(inTime.value,outTime.value)
});
}

/* DELETE */
function del(id){if(confirm("Delete?")) db.collection("attendance").doc(id).delete();}

/* EDIT */
function edit(id){
let r=data.find(x=>x.id===id);
date.value=r.d;inTime.value=r.i;outTime.value=r.o;
post.value=r.p;bg.value=r.bg;font.value=r.font;
del(id);
}

/* RENDER */
function render(){
tbody.innerHTML=""; let m=monthFilter.value,td=0,th=0;
data.sort((a,b)=>new Date(a.d+" "+a.i)-new Date(b.d+" "+b.i))
.forEach(r=>{
if(r.d.split("-")[1]!==m)return;
td++; th+=+r.h;
tbody.innerHTML+=`
<tr class="${r.i>r.o?'night':''}" style="background:${r.bg};color:${r.font}">
<td>${r.d}</td><td>${r.i}</td><td>${r.o}</td>
<td>${r.h}</td><td>${r.p}</td>
<td><button onclick="edit('${r.id}')">‚úèÔ∏è</button></td>
<td><button onclick="del('${r.id}')">‚ùå</button></td>
</tr>`;
});
duty.innerText=td; hours.innerText=th.toFixed(2);
}

/* EXCEL */
function download(){
let csv="Date,In,Out,Hours,Post\n";
data.forEach(r=>csv+=`${r.d},${r.i},${r.o},${r.h},${r.p}\n`);
let a=document.createElement("a");
a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
a.download="attendance.csv"; a.click();
}
</script>

</body>
</html>
