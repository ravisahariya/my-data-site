<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Duty Dashboard Pro</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

body{
 background:linear-gradient(135deg,#4e73df,#1cc88a);
 font-family:system-ui;
 min-height:100vh;
}

/* LOGIN CARD */
.login-card{
 max-width:380px;
 margin:80px auto;
 padding:30px;
 border-radius:15px;
 background:#fff;
 box-shadow:0 10px 25px rgba(0,0,0,.25);
}

/* DASHBOARD */
.dashboard{
 max-width:1400px;
 margin:20px auto;
 padding:20px;
 border-radius:15px;
 background:#fff;
 box-shadow:0 10px 25px rgba(0,0,0,.25);
}

.hidden{display:none}

.table-box{
 max-height:350px;
 overflow:auto;
}

table{
 table-layout:fixed;
 width:100%;
}

th,td{
 white-space:nowrap;
 overflow:hidden;
 text-overflow:ellipsis;
 font-size:14px;
}

.big-btn{
 height:50px;
 font-size:18px;
}

</style>
</head>

<body>


<!-- ================= LOGIN ================= -->

<div id="loginPage" class="login-card text-center">

<h3 class="mb-4">üîê Login</h3>

<button class="btn btn-secondary mb-3 w-100" onclick="secret()">Secret</button>

<div id="secretBox" class="hidden text-danger mb-2">
User: admin<br>Password: 12345
</div>

<input id="uid" class="form-control mb-3" placeholder="User ID">
<input id="pwd" type="password" class="form-control mb-3" placeholder="Password">

<button onclick="login()" class="btn btn-primary w-100 big-btn">Login</button>

</div>



<!-- ================= DASHBOARD ================= -->

<div id="app" class="dashboard hidden">

<div class="d-flex justify-content-between align-items-center mb-3">
<h4>üìã Duty Record Dashboard</h4>
<button class="btn btn-danger" onclick="logout()">Logout</button>
</div>


<!-- ENTRY CARD -->
<div class="card p-3 mb-3">

<form id="form" class="row g-2">

<input required id="company" class="form-control col-md-3" placeholder="‡§ï‡§Ç‡§™‡§®‡•Ä">

<input required type="date" id="date" class="form-control col-md-2">

<select id="shift" class="form-control col-md-2">
<option>‡§¶‡§ø‡§®</option>
<option>‡§∞‡§æ‡§§</option>
</select>

<input type="time" id="start" class="form-control col-md-2">
<input type="time" id="end" class="form-control col-md-2">

<input id="work" class="form-control col-md-3" placeholder="‡§ï‡§æ‡§Æ / ‡§®‡•ã‡§ü‡•ç‡§∏">

<div class="col-md-3">
Font <input type="color" id="fc" value="#000000">
BG <input type="color" id="bc" value="#ffffff">
</div>

<button class="btn btn-success col-md-2 big-btn">Save</button>

</form>

</div>


<!-- FILTERS -->
<div class="d-flex justify-content-between mb-2">

<select id="month" onchange="loadData()" class="form-select w-auto">
<option value="">All Months</option>
<option value="01">Jan</option><option value="02">Feb</option>
<option value="03">Mar</option><option value="04">Apr</option>
<option value="05">May</option><option value="06">Jun</option>
<option value="07">Jul</option><option value="08">Aug</option>
<option value="09">Sep</option><option value="10">Oct</option>
<option value="11">Nov</option><option value="12">Dec</option>
</select>

<input id="search" onkeyup="loadData()" class="form-control w-25" placeholder="Search">

<div>
<button onclick="downloadCSV()" class="btn btn-success btn-sm">CSV</button>
<button onclick="downloadCSV()" class="btn btn-primary btn-sm">Excel</button>
<button onclick="window.print()" class="btn btn-danger btn-sm">PDF</button>
</div>

</div>


<!-- TABLE -->
<div class="table-box">

<table class="table table-bordered table-sm">

<thead class="table-light">
<tr>
<th>Company</th>
<th>Date</th>
<th>Day</th>
<th>Shift</th>
<th>Time</th>
<th>Work</th>
<th>Hours</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

</table>

</div>


<div class="d-flex justify-content-between mt-2">
<b>Total Hours: <span id="total">0</span></b>
<b>Total Entries: <span id="count">0</span></b>
</div>

</div>



<script>

const USER="admin",PASS="12345";
let editIndex=-1;


/* LOGIN */
function secret(){
 let y=prompt("Enter Secret Year");
 if(y==1995) secretBox.classList.remove("hidden");
}

function login(){
 if(uid.value==USER && pwd.value==PASS){
  localStorage.setItem("login",1);
  show();
 }
}

function logout(){
 localStorage.clear();
 location.reload();
}

function show(){
 loginPage.classList.add("hidden");
 app.classList.remove("hidden");
 loadData();
}

if(localStorage.getItem("login")) show();


/* HELPERS */
function dayName(d){
 return ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(d).getDay()];
}

function hours(a,b){
 let s=new Date("1970-1-1 "+a);
 let e=new Date("1970-1-1 "+b);
 if(e<s) e.setDate(e.getDate()+1);
 return ((e-s)/3600000).toFixed(2);
}


/* SAVE */
form.onsubmit=function(e){

 e.preventDefault();

 let data=JSON.parse(localStorage.getItem("duty")||"[]");

 let obj={
  company:company.value,
  date:date.value,
  shift:shift.value,
  start:start.value,
  end:end.value,
  work:work.value,
  fc:fc.value,
  bc:bc.value
 };

 if(editIndex>=0){ data[editIndex]=obj; editIndex=-1; }
 else data.push(obj);

 localStorage.setItem("duty",JSON.stringify(data));

 form.reset();
 loadData();
};


/* LOAD + DUPLICATE */
function loadData(){

 let data=JSON.parse(localStorage.getItem("duty")||"[]");

 let m=month.value;
 let s=search.value.toLowerCase();

 tbody.innerHTML="";
 let totalH=0,countE=0;

 let dateCount={};
 data.forEach(x=>dateCount[x.date]=(dateCount[x.date]||0)+1);

 data.forEach((x,i)=>{

  if(m && x.date.substr(5,2)!=m) return;
  if(s && !(x.company+x.work).toLowerCase().includes(s)) return;

  let h=parseFloat(hours(x.start,x.end));
  totalH+=h; countE++;

  let tr=document.createElement("tr");

  tr.style.color=x.fc;

  if(dateCount[x.date]>1) tr.style.background="#ffe08a";
  else tr.style.background=x.bc;

  tr.innerHTML=`
  <td>${x.company}</td>
  <td>${x.date}</td>
  <td>${dayName(x.date)}</td>
  <td>${x.shift}</td>
  <td>${x.start}-${x.end}</td>
  <td>${x.work}</td>
  <td>${h}</td>
  <td>
  <button onclick="editRow(${i})" class="btn btn-warning btn-sm">Edit</button>
  <button onclick="delRow(${i})" class="btn btn-danger btn-sm">Delete</button>
  </td>`;

  tbody.appendChild(tr);

 });

 total.innerText=totalH.toFixed(2);
 count.innerText=countE;
}


/* EDIT */
function editRow(i){
 let d=JSON.parse(localStorage.getItem("duty"))[i];
 Object.keys(d).forEach(k=>window[k].value=d[k]);
 editIndex=i;
}

/* DELETE */
function delRow(i){
 if(confirm("Delete entry?")){
  let d=JSON.parse(localStorage.getItem("duty"));
  d.splice(i,1);
  localStorage.setItem("duty",JSON.stringify(d));
  loadData();
 }
}

/* CSV */
function downloadCSV(){
 let rows=[...tbody.rows].map(r=>[...r.cells].slice(0,7).map(c=>c.innerText).join(",")).join("\n");
 let a=document.createElement("a");
 a.href="data:text/csv;charset=utf-8,"+encodeURI(rows);
 a.download="duty.csv";
 a.click();
}

</script>

</body>
 </html>
