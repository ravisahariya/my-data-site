<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Attendance MASTER PRO</title>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
#loginPage{height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#667eea,#764ba2)}
.card{background:#fff;padding:25px;border-radius:10px;text-align:center}

#app{display:none;height:100vh;flex-direction:column}
.topbar{display:flex;justify-content:space-between;padding:8px}
.logout{background:#f44336;color:white;border:none;padding:6px 12px}

input,select,button{padding:5px;margin:2px}
.table-box{flex:1;overflow:auto;background:white}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:5px;text-align:center}
th{background:#ffd9d9}
.total{background:#ffeaa7;font-weight:bold}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
<div class="card">
<h2>ğŸ” Login</h2>
<input id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<div onclick="unlockSecret()">ğŸ”’ Secret</div>
</div>
</div>

<!-- APP -->
<div id="app">

<div class="topbar">
<h3>â˜ï¸ Attendance MASTER</h3>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div>
<input type="date" id="date">
<input type="time" id="inTime">
<input type="time" id="outTime">
<input id="post" placeholder="Post">
<button onclick="save()">Save</button>
</div>

<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th>
<th>Post</th><th>BG</th><th>Font</th><th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>

<tfoot>
<tr class="total">
<td>Total Duty: <span id="duty">0</span></td>
<td colspan="2">Total Hours</td>
<td id="hours">0</td>
<td colspan="5"></td>
</tr>
</tfoot>
</table>
</div>
</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyD71mpolAsmejtU2icecQQcX07iCW_is0Y",
 authDomain:"ravicardmaker.firebaseapp.com",
 projectId:"ravicardmaker"
});
const db=firebase.firestore();

/* LOGIN */
if(localStorage.getItem("login")) showApp();
function login(){ if(username.value==="Ravi" && password.value==="Ravi123"){ localStorage.setItem("login","1"); showApp(); }}
function logout(){ localStorage.removeItem("login"); location.reload(); }
function showApp(){ loginPage.style.display="none"; app.style.display="flex"; }
function unlockSecret(){ if(prompt("Year?")==="1995") alert("Username: Ravi\nPassword: Ravi123"); }

/* DATA */
let data=[];
db.collection("attendance").onSnapshot(s=>{
 data=[];
 s.forEach(d=>data.push({id:d.id,...d.data()}));
 render();
});

function calc(i,o){
 let a=new Date("2000 "+i), b=new Date("2000 "+o);
 if(b<a) b.setDate(b.getDate()+1);
 return ((b-a)/3600000).toFixed(2);
}

function save(){
 db.collection("attendance").add({
  d:date.value,
  i:inTime.value,
  o:outTime.value,
  p:post.value,
  h:calc(inTime.value,outTime.value),
  bg:"#fffacd",
  font:"#000"
 });
}

function del(id){
 if(confirm("Delete?"))
  db.collection("attendance").doc(id).delete();
}

/* FULL ROW EDIT */
function editRow(r){
 return `
 <tr>
 <td><input type="date" value="${r.d}" id="d${r.id}"></td>
 <td><input type="time" value="${r.i}" id="i${r.id}"></td>
 <td><input type="time" value="${r.o}" id="o${r.id}"></td>
 <td>-</td>
 <td><input value="${r.p}" id="p${r.id}"></td>
 <td><input type="color" value="${r.bg}" id="bg${r.id}"></td>
 <td><input type="color" value="${r.font}" id="f${r.id}"></td>
 <td><button onclick="updateRow('${r.id}')">ğŸ’¾</button></td>
 <td><button onclick="render()">âŒ</button></td>
 </tr>`;
}

function updateRow(id){
 let d=document.getElementById("d"+id).value;
 let i=document.getElementById("i"+id).value;
 let o=document.getElementById("o"+id).value;
 let p=document.getElementById("p"+id).value;
 let bg=document.getElementById("bg"+id).value;
 let font=document.getElementById("f"+id).value;

 db.collection("attendance").doc(id).update({
  d,i,o,p,
  h:calc(i,o),
  bg,font
 });
}

/* RENDER */
function render(){
 tbody.innerHTML="";
 let th=0, td=0;

 data.forEach(r=>{
  th+=+r.h; td++;

  tbody.innerHTML+=`
  <tr style="background:${r.bg};color:${r.font}">
  <td>${r.d}</td>
  <td>${r.i}</td>
  <td>${r.o}</td>
  <td>${r.h}</td>
  <td>${r.p}</td>
  <td><input type="color" value="${r.bg}" disabled></td>
  <td><input type="color" value="${r.font}" disabled></td>
  <td><button onclick="document.getElementById('tbody').innerHTML=editRow(${JSON.stringify(r).replace(/"/g,'&quot;')})">âœï¸</button></td>
  <td><button onclick="del('${r.id}')">âŒ</button></td>
  </tr>`;
 });

 hours.innerText=th.toFixed(2);
 duty.innerText=td;
}
</script>
</body>
</html>
