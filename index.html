<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Digital Register</title>

<style>
body{
  font-family: Arial;
  background:#f2f5ff;
}
.box{
  max-width:500px;
  margin:15px auto;
  background:#fff;
  padding:15px;
  border-radius:10px;
}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
}
button{
  border:none;
  border-radius:5px;
  font-weight:bold;
}
.save{background:#1e73d8;color:#fff}
.add{background:#2ecc71;color:#fff}
.logout{background:#e53935;color:#fff}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
.edit{background:#fbc02d}
.del{background:#e53935;color:#fff}
</style>
</head>

<body>

<div class="box">
<button class="logout" onclick="logout()">Logout</button>
<h3>Digital Register</h3>

<select id="month">
  <option>January 2026</option>
  <option>February 2026</option>
  <option>March 2026</option>
</select>

<input type="date" id="date">

<select id="shift">
  <option>Day</option>
  <option>Night</option>
</select>

<select id="post" id="post">
  <option>ETP</option>
  <option>ABEER</option>
  <option>DENIEM</option>
</select>

<input id="newPost" placeholder="Add Post">
<button class="add" onclick="addPost()">Add Post</button>

<select id="sign">
  <option>Ravi</option>
</select>

<input type="color" id="rowColor">

<button class="save" onclick="save()">Save</button>

<b id="count">Day:0 | Night:0 | Total:0</b>

<table>
<thead>
<tr>
<th>Date</th><th>Shift</th><th>Post</th><th>Sign</th><th>Edit</th><th>Del</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>

<button class="save" onclick="download()">Download CSV</button>
</div>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
 getFirestore, collection, addDoc, getDocs,
 updateDoc, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "PASTE_YOUR_KEY",
  authDomain: "PASTE.firebaseapp.com",
  projectId: "PASTE_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let editId=null;

window.save = async function(){
 const data={
  month:month.value,
  date:date.value,
  shift:shift.value,
  post:post.value,
  sign:sign.value,
  color:rowColor.value
 };

 if(editId){
  await updateDoc(doc(db,"register",editId),data);
  editId=null;
 }else{
  await addDoc(collection(db,"register"),data);
 }
 load();
}

window.load = async function(){
 data.innerHTML="";
 let day=0,night=0,total=0;

 const q=await getDocs(collection(db,"register"));
 q.forEach(d=>{
  const r=d.data();
  if(r.month!==month.value)return;

  total++;
  r.shift==="Day"?day++:night++;

  data.innerHTML+=`
  <tr style="color:${r.color}">
   <td>${r.date}</td>
   <td>${r.shift}</td>
   <td>${r.post}</td>
   <td>${r.sign}</td>
   <td><button class="edit" onclick="edit('${d.id}','${r.date}','${r.shift}','${r.post}','${r.sign}','${r.color}')">Edit</button></td>
   <td><button class="del" onclick="delRow('${d.id}')">X</button></td>
  </tr>`;
 });

 count.innerText=`Day:${day} | Night:${night} | Total:${total}`;
}

window.edit=function(id,d,s,p,sg,c){
 editId=id;
 date.value=d;
 shift.value=s;
 post.value=p;
 sign.value=sg;
 rowColor.value=c;
}

window.delRow=async function(id){
 if(confirm("Delete record?")){
  await deleteDoc(doc(db,"register",id));
  load();
 }
}

window.addPost=function(){
 if(newPost.value){
  post.innerHTML+=`<option>${newPost.value}</option>`;
  newPost.value="";
 }
}

window.download=function(){
 let csv="Date,Shift,Post,Sign\n";
 document.querySelectorAll("#data tr").forEach(r=>{
  csv+=Array.from(r.children).slice(0,4).map(td=>td.innerText).join(",")+"\n";
 });
 const a=document.createElement("a");
 a.href="data:text/csv,"+encodeURIComponent(csv);
 a.download="register.csv";
 a.click();
}

window.logout=function(){
 alert("Logout");
}

load();
</script>

</body>
</html>
