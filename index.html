<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register + Attendance</title>

<style>
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#0b4d2e;
  }
  .card{
    max-width:420px;
    margin:20px auto;
    background:#fff;
    padding:15px;
    border-radius:10px;
  }
  h2{text-align:center}
  label{font-size:14px;font-weight:bold}
  select,input,button{
    width:100%;
    padding:8px;
    margin-top:5px;
    margin-bottom:10px;
    font-size:14px;
  }
  button{
    background:#0b4d2e;
    color:#fff;
    border:none;
    border-radius:5px;
  }
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
    font-size:13px;
  }
  th,td{
    border:1px solid #ccc;
    padding:5px;
    text-align:center;
  }
  th{background:#eee}
  .logout{
    background:#d32f2f;
    margin-top:10px;
  }
</style>
</head>

<body>

<div class="card">
  <h2>Register + Attendance</h2>

  <!-- Month -->
  <label>Month</label>
  <select id="month">
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <!-- Date calendar -->
  <label>Date</label>
  <input type="date" id="date" required>

  <!-- Shift -->
  <label>Shift</label>
  <select id="shift">
    <option>Day</option>
    <option>Night</option>
  </select>

  <!-- Status -->
  <label>Status</label>
  <select id="status">
    <option>Present</option>
    <option>Absent</option>
  </select>

  <!-- Post dropdown -->
  <label>Post</label>
  <select id="post">
    <option>COE</option>
    <option>ABEER</option>
    <option>DENIEM</option>
    <option>ETP</option>
    <option>ACL</option>
    <option>BORD2</option>
    <option>CASUAL</option>
    <option>CCTV</option>
  </select>

  <!-- Signature -->
  <label>Signature</label>
  <select id="sign">
    <option>Ravi</option>
  </select>

  <!-- Row color -->
  <label>Row Color</label>
  <input type="color" id="rowColor" value="#ffffff">

  <button onclick="saveEntry()">Save Entry</button>

  <!-- Table -->
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Shift</th>
        <th>Status</th>
        <th>Post</th>
        <th>Sign</th>
        <th>Edit</th>
        <th>Del</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr>
        <th>Total</th>
        <th id="dayCount">0</th>
        <th id="nightCount">0</th>
        <th colspan="4"></th>
      </tr>
    </tfoot>
  </table>

  <button class="logout" onclick="logout()">Logout</button>
</div>

<script>
let editIndex = -1;

function saveEntry(){
  const date = document.getElementById("date").value;
  if(!date){ alert("Date required"); return; }

  const entry = {
    month: document.getElementById("month").value,
    date: date,
    shift: document.getElementById("shift").value,
    status: document.getElementById("status").value,
    post: document.getElementById("post").value,
    sign: document.getElementById("sign").value,
    color: document.getElementById("rowColor").value
  };

  let data = JSON.parse(localStorage.getItem("attendanceData") || "[]");

  if(editIndex === -1){
    data.push(entry);
  }else{
    data[editIndex] = entry;
    editIndex = -1;
  }

  localStorage.setItem("attendanceData", JSON.stringify(data));
  renderTable();
}

function renderTable(){
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  let data = JSON.parse(localStorage.getItem("attendanceData") || "[]");

  // date wise sort
  data.sort((a,b)=> new Date(a.date) - new Date(b.date));

  let day=0, night=0;

  data.forEach((e,i)=>{
    if(e.shift==="Day" && e.status==="Present") day++;
    if(e.shift==="Night" && e.status==="Present") night++;

    let tr = document.createElement("tr");
    tr.style.background = e.color;

    tr.innerHTML = `
      <td>${new Date(e.date).toLocaleDateString("en-GB")}</td>
      <td>${e.shift}</td>
      <td>${e.status}</td>
      <td>${e.post}</td>
      <td>${e.sign}</td>
      <td><button onclick="editEntry(${i})">✏️</button></td>
      <td><button onclick="deleteEntry(${i})">❌</button></td>
    `;
    body.appendChild(tr);
  });

  document.getElementById("dayCount").innerText = day;
  document.getElementById("nightCount").innerText = night;
}

function editEntry(i){
  let data = JSON.parse(localStorage.getItem("attendanceData"));
  let e = data[i];

  document.getElementById("month").value = e.month;
  document.getElementById("date").value = e.date;
  document.getElementById("shift").value = e.shift;
  document.getElementById("status").value = e.status;
  document.getElementById("post").value = e.post;
  document.getElementById("sign").value = e.sign;
  document.getElementById("rowColor").value = e.color;

  editIndex = i;
}

function deleteEntry(i){
  if(!confirm("Delete this entry?")) return;
  let data = JSON.parse(localStorage.getItem("attendanceData"));
  data.splice(i,1);
  localStorage.setItem("attendanceData", JSON.stringify(data));
  renderTable();
}

function logout(){
  alert("Logout");
  location.reload();
}

renderTable();
</script>

</body>
</html>
