<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Attendance Secure App</title>

<style>

/* ===== BODY ===== */
body{
  margin:0;
  font-family:Arial;
  height:100vh;
}

/* ================= LOGIN PAGE ================= */

.loginPage{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#667eea,#764ba2);
}

.card{
  width:90%;
  max-width:350px;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  text-align:center;
}

.card h2{
  margin-bottom:20px;
}

.card input{
  width:100%;
  padding:10px;
  margin:8px 0;
  font-size:16px;
}

.card button{
  width:100%;
  padding:10px;
  font-size:16px;
  background:#4CAF50;
  color:white;
  border:none;
}

.secret{
  font-size:26px;
  cursor:pointer;
  margin-top:10px;
}

/* ================= ATTENDANCE ================= */

.app{
  display:none;
  height:100vh;
  background:#f2f2f2;
  display:flex;
  flex-direction:column;
}

.form{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  padding:6px;
}

input,select{
  padding:8px;
}

.tools{
  display:flex;
  gap:6px;
  padding:6px;
  flex-wrap:wrap;
}

.table-box{
  flex:1;
  overflow:auto;
  background:white;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
  white-space:nowrap;
}

th{
  background:#ffd9d9;
  position:sticky;
  top:0;
}

.total{
  background:#ffeaa7;
  font-weight:bold;
}

.edit{background:#2196F3;color:white}
.del{background:#f44336;color:white}

</style>
</head>

<body>

<!-- ================= LOGIN ================= -->

<div class="loginPage" id="loginPage">

  <div class="card">
    <h2>üîê Admin Login</h2>

    <input type="password" id="password" placeholder="Enter Password">

    <button onclick="login()">Login</button>

    <!-- secret icon -->
    <div class="secret" onclick="unlockSecret()">üîí</div>
  </div>

</div>



<!-- ================= ATTENDANCE ================= -->

<div class="app" id="app">

<h3 style="text-align:center">üìã Attendance MASTER PRO</h3>

<div class="form">
<input type="date" id="date">
<input type="time" id="inTime">
<input type="time" id="outTime">

<select id="post">
<option>ETP</option>
<option>BOARD 2</option>
<option>COE</option>
<option>ACL</option>
<option>BEBRIG</option>
</select>

<button onclick="save()">Save</button>
</div>

<div class="tools">
<input type="month" id="monthFilter" onchange="render()">
<input type="text" id="search" placeholder="Search..." onkeyup="render()">

<button onclick="downloadCSV()">Excel</button>
<button onclick="window.print()">Print</button>
</div>

<div class="table-box">
<table>

<thead>
<tr>
<th>Date</th>
<th>In</th>
<th>Out</th>
<th>Hours</th>
<th>Post</th>
<th>BG</th>
<th>Font</th>
<th>Edit</th>
<th>Delete</th>
</tr>
</thead>

<tbody id="tbody"></tbody>

<tfoot>
<tr class="total">
<td>Total Duty: <span id="dutyCount">0</span></td>
<td colspan="2">Grand Total Hours</td>
<td id="totalHours">0</td>
<td colspan="5"></td>
</tr>
</tfoot>

</table>
</div>

</div>



<script>

/* ================= LOGIN LOGIC ================= */

function login(){
 let pass=password.value;

 if(pass==="ravi8888"){
   loginPage.style.display="none";
   app.style.display="flex";
 }else{
   alert("Wrong Password");
 }
}

/* secret unlock */
function unlockSecret(){

 let year=prompt("Enter Secret Year");

 if(year==="1995"){
   password.type="text";
   alert("Password Visible üîì");
 }
}



/* ================= ATTENDANCE SYSTEM ================= */

let data = JSON.parse(localStorage.getItem("attData")) || [];
let editIndex=-1;


function save(){

 let d=date.value;
 let i=inTime.value;
 let o=outTime.value;
 let p=post.value;

 if(!d||!i||!o) return alert("Fill all fields");

 let h=calcHours(i,o);

 if(editIndex>=0){
   data[editIndex]={...data[editIndex],d,i,o,h,p};
   editIndex=-1;
 }
 else{
   data.push({d,i,o,h,p,bg:"#fffacd",font:"#000"});
 }

 store();
 render();
 clear();
}

function calcHours(a,b){
 let x=new Date("2000-01-01 "+a);
 let y=new Date("2000-01-01 "+b);
 if(y<x) y.setDate(y.getDate()+1);
 return ((y-x)/3600000).toFixed(2);
}

function render(){

 tbody.innerHTML="";
 let totalH=0,duty=0;

 data.sort((a,b)=> new Date(a.d)-new Date(b.d));

 data.forEach((r,i)=>{

   totalH+=parseFloat(r.h);
   duty++;

   let tr=document.createElement("tr");

   tr.style.background=r.bg;
   tr.style.color=r.font;

   tr.innerHTML=`
   <td>${r.d}</td>
   <td>${r.i}</td>
   <td>${r.o}</td>
   <td>${r.h}</td>
   <td>${r.p}</td>
   <td><input type="color" value="${r.bg}" onchange="setBg(${i},this.value)"></td>
   <td><input type="color" value="${r.font}" onchange="setFont(${i},this.value)"></td>
   <td><button class="edit" onclick="edit(${i})">‚úèÔ∏è</button></td>
   <td><button class="del" onclick="del(${i})">‚ùå</button></td>
   `;

   tbody.appendChild(tr);
 });

 totalHours.innerText=totalH.toFixed(2);
 dutyCount.innerText=duty;
}

function setBg(i,c){data[i].bg=c;store();render();}
function setFont(i,c){data[i].font=c;store();render();}

function del(i){
 if(confirm("Delete entry?")){
   data.splice(i,1);
   store();
   render();
 }
}

function edit(i){
 let r=data[i];
 date.value=r.d;
 inTime.value=r.i;
 outTime.value=r.o;
 post.value=r.p;
 editIndex=i;
}

function store(){
 localStorage.setItem("attData",JSON.stringify(data));
}

function clear(){
 date.value="";
 inTime.value="";
 outTime.value="";
}

function downloadCSV(){
 let csv="Date,In,Out,Hours,Post\n";
 data.forEach(r=> csv+=`${r.d},${r.i},${r.o},${r.h},${r.p}\n`);

 let blob=new Blob([csv]);
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="attendance.csv";
 a.click();
}

render();

</script>

</body>
</html>
