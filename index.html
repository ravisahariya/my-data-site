l<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Attendance MASTER</title>

<style>
body{margin:0;font-family:Arial}

/* ========= LOGIN ========= */
#loginPage{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(45deg,#667eea,#764ba2);
}

.card{
width:95%;
max-width:650px;
background:white;
padding:60px 40px;
border-radius:25px;
text-align:center;
box-shadow:0 20px 45px rgba(0,0,0,.35);
}

.card input{
width:100%;
padding:18px;
margin:12px 0;
font-size:18px;
}

.card button{
width:100%;
padding:16px;
font-size:18px;
margin-top:10px;
background:#1976d2;
color:white;
border:none;
border-radius:10px;
}

/* ========= APP ========= */
#app{display:none;height:100vh;background:#f2f2f2;overflow:hidden}

header{
position:fixed;
top:0;
width:100%;
background:#1976d2;
color:white;
text-align:center;
padding:12px;
font-weight:bold;
}

footer{
position:fixed;
bottom:0;
width:100%;
background:#ffd54f;
padding:8px;
font-weight:bold;
}

.form{
margin-top:60px;
padding:6px;
text-align:center;
}

.form input,.form select,.form button{
padding:6px;
margin:2px;
}

.table-box{
height:55vh;
overflow:auto;
}

table{
width:100%;
border-collapse:collapse;
background:white;
}

th,td{
border:1px solid #ccc;
padding:6px;
text-align:center;
}

th{background:#ffebee}
</style>
</head>

<body>

<!-- ================= LOGIN ================= -->

<div id="loginPage">
<div class="card">

<h2>üîê Attendance Login</h2>

<input value="Admin" readonly>
<input id="pass" type="password" placeholder="Enter Password">

<button onclick="login()">Login</button>

<button onclick="openSecret()" style="background:none;color:#444">üîí Secret</button>

<div id="secretPanel" style="display:none;margin-top:10px">
User: <b id="showU"></b><br>
Pass: <b id="showP"></b><br><br>
<input id="newPass" placeholder="New Password">
<button onclick="changePass()">Change Password</button>
</div>

</div>
</div>


<!-- ================= APP ================= -->

<div id="app">

<header>Attendance MASTER</header>

<div class="form">

<input type="date" id="date">
<input type="time" id="in">
<input type="time" id="out">

<select id="post">
<option>ETP</option>
<option>BORD 2</option>
<option>COE</option>
<option>ABEER</option>
</select>

BG <input type="color" id="bg" value="#fff">
Font <input type="color" id="font" value="#000">

<button onclick="saveEntry()">Save</button>

<select id="monthFilter" onchange="loadTable()"></select>

<button onclick="downloadCSV()">Excel</button>
<button onclick="logout()">Logout</button>

</div>

<div class="table-box">
<table id="tbl">
<thead>
<tr>
<th>Date</th>
<th>In</th>
<th>Out</th>
<th>Hours</th>
<th>Post</th>
<th>Edit</th>
<th>Delete</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<footer>
Total Duty: <span id="duty">0</span> |
Total Hours: <span id="hours">0</span>
</footer>

</div>



<script>

/* ========= LOGIN ========= */

let userData=JSON.parse(localStorage.getItem("userData"))||{pass:"1234"};

function login(){
 if(pass.value===userData.pass){
  loginPage.style.display="none";
  app.style.display="block";
  loadTable();
 } else alert("Wrong password");
}

function logout(){
 app.style.display="none";
 loginPage.style.display="flex";
 pass.value="";
}

function openSecret(){
 let s=prompt("Secret code");
 if(s==="1995"){
  secretPanel.style.display="block";
  showU.innerText="Admin";
  showP.innerText=userData.pass;
 }
}

function changePass(){
 userData.pass=newPass.value;
 localStorage.setItem("userData",JSON.stringify(userData));
 alert("Changed");
 secretPanel.style.display="none";
}


/* ========= DATA ========= */

let data=JSON.parse(localStorage.getItem("attData"))||[];


/* ========= MONTH DROPDOWN ========= */

let months=["All","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

months.forEach((m,i)=>{
 monthFilter.innerHTML+=`<option value="${i}">${m}</option>`;
});

monthFilter.value=new Date().getMonth()+1;


/* ========= HOURS ========= */

function calcHours(a,b){
 let s=new Date("2000-01-01 "+a);
 let e=new Date("2000-01-01 "+b);
 if(e<s)e.setDate(e.getDate()+1);
 return ((e-s)/3600000).toFixed(2);
}


/* ========= SAVE ========= */

function saveEntry(){

 if(!date.value||!in.value||!out.value) return;

 let h=calcHours(in.value,out.value);

 data.push({
  date:date.value,
  in:in.value,
  out:out.value,
  hours:h,
  post:post.value,
  bg:bg.value,
  font:font.value
 });

 localStorage.setItem("attData",JSON.stringify(data));
 loadTable();
}


/* ========= LOAD ========= */

function loadTable(){

 let tb=tbl.querySelector("tbody");
 tb.innerHTML="";
 let total=0,count=0;

 let m=monthFilter.value;

 data.forEach((r,i)=>{

 let month=new Date(r.date).getMonth()+1;

 if(m!=0 && month!=m) return;

 total+=parseFloat(r.hours);
 count++;

 tb.innerHTML+=`
 <tr style="background:${r.bg};color:${r.font}">
 <td>${r.date}</td>
 <td>${r.in}</td>
 <td>${r.out}</td>
 <td>${r.hours}</td>
 <td>${r.post}</td>
 <td><button onclick="editRow(${i})">‚úèÔ∏è</button></td>
 <td><button onclick="deleteRow(${i})">‚ùå</button></td>
 </tr>`;
 });

 duty.innerText=count;
 hours.innerText=total.toFixed(2);
}


/* ========= EDIT ========= */

function editRow(i){
 let r=data[i];
 date.value=r.date;
 in.value=r.in;
 out.value=r.out;
 post.value=r.post;
 bg.value=r.bg;
 font.value=r.font;
 data.splice(i,1);
 loadTable();
}


/* ========= DELETE ========= */

function deleteRow(i){
 if(confirm("Delete?")){
  data.splice(i,1);
  localStorage.setItem("attData",JSON.stringify(data));
  loadTable();
 }
}


/* ========= EXCEL ========= */

function downloadCSV(){

 let rows=[...tbl.rows];

 let csv=[...rows].map(r=>
  [...r.cells].map(c=>c.innerText).join(",")
 ).join("\n");

 let blob=new Blob([csv]);

 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="attendance.csv";
 a.click();
}


loadTable();

</script>

</body>
</html>
