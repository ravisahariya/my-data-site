<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Attendance MASTER PRO</title>

<style>
body{
margin:0;
font-family:Arial;
background:#eef1f6;
}

/* ========= LOGIN ========= */

#loginPage{
height:100vh;
display:flex;
align-items:center;
justify-content:center;
background:linear-gradient(135deg,#6a6cff,#9c6cff);
}

.loginCard{
width:420px;
padding:45px;
background:white;
border-radius:20px;
text-align:center;
box-shadow:0 15px 40px rgba(0,0,0,.3);
}

.loginCard h2{margin-bottom:20px;}

.loginCard input{
width:90%;
padding:10px;
margin:8px 0;
}

.secret{
cursor:pointer;
font-size:14px;
margin-top:10px;
}

/* ========= APP ========= */

#app{display:none;height:100vh;flex-direction:column;}

header{
background:#fff;
padding:8px;
position:sticky;
top:0;
z-index:10;
box-shadow:0 2px 5px rgba(0,0,0,.2);
}

footer{
background:#ffe7a1;
padding:8px;
position:sticky;
bottom:0;
font-weight:bold;
}

.tableWrap{
flex:1;
overflow:auto;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
border:1px solid #ccc;
padding:6px;
text-align:center;
}

th{
background:#ffdede;
position:sticky;
top:0;
}

button{cursor:pointer}

.logout{
background:#ff3b30;
color:white;
float:right;
}
</style>
</head>

<body>

<!-- ================= LOGIN ================= -->
<div id="loginPage">
<div class="loginCard">

<h2>üëÜ Attendance Login</h2>

<input id="user" placeholder="User">
<input id="pass" type="password" placeholder="Password">

<button onclick="login()">Login</button>

<div class="secret" onclick="secretBox()">üîí Secret</div>

</div>
</div>


<!-- ================= APP ================= -->
<div id="app">

<header>

Date <input type="date" id="date">
In <input type="time" id="in">
Out <input type="time" id="out">

Post <input id="post">

BG <input type="color" id="bg">
Font <input type="color" id="font">

<button onclick="save()">Save</button>
<button onclick="clearForm()">Clear</button>

<select id="monthFilter" onchange="render()"></select>

<input id="search" placeholder="Search" onkeyup="render()">

<button onclick="exportExcel()">Excel</button>
<button onclick="window.print()">Print</button>

<button class="logout" onclick="logout()">Logout</button>

</header>

<div class="tableWrap">
<table>
<thead>
<tr>
<th>Date</th>
<th>In</th>
<th>Out</th>
<th>Hours</th>
<th>Post</th>
<th>Edit</th>
<th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<footer id="footer"></footer>

</div>


<script>

/* ========= LOGIN ========= */

function login(){
if(user.value==="9823087" && pass.value==="7284"){
localStorage.setItem("login","1");
showApp();
}else alert("Wrong login");
}

function logout(){
localStorage.removeItem("login");
location.reload();
}

function showApp(){
loginPage.style.display="none";
app.style.display="flex";
initMonth();
render();
}

if(localStorage.getItem("login")) showApp();

function secretBox(){
let y=prompt("Enter year");
if(y==="1995") alert("User: 9823087\nPassword: 7284");
}


/* ========= DATA ========= */

let data=JSON.parse(localStorage.getItem("attData")||"[]");

function saveData(){
localStorage.setItem("attData",JSON.stringify(data));
}

function hours(a,b){
let s=new Date("2020-01-01 "+a);
let e=new Date("2020-01-01 "+b);
if(e<s)e.setDate(e.getDate()+1);
return ((e-s)/3600000).toFixed(2);
}

function save(){

let obj={
id:Date.now(),
date:date.value,
in:in.value,
out:out.value,
post:post.value,
bg:bg.value,
font:font.value
};

let i=data.findIndex(x=>x.editing);
if(i>=0)data[i]=obj;
else data.push(obj);

data.forEach(x=>delete x.editing);

saveData();
render();
clearForm();
}

function clearForm(){
date.value="";
in.value="";
out.value="";
post.value="";
}


/* ========= RENDER ========= */

function render(){

let m=monthFilter.value;
let s=search.value.toLowerCase();

let arr=data.filter(x=>{
let ok=true;

if(m!=="all") ok=x.date.slice(5,7)===m;
if(s) ok=x.post.toLowerCase().includes(s);

return ok;
});

arr.sort((a,b)=>{
if(a.date===b.date) return a.in.localeCompare(b.in);
return a.date.localeCompare(b.date);
});

tbody.innerHTML="";

let total=0;

arr.forEach(r=>{

let h=hours(r.in,r.out);
total+=+h;

let tr=document.createElement("tr");
tr.style.background=r.bg;
tr.style.color=r.font;

tr.innerHTML=`
<td>${r.date}</td>
<td>${r.in}</td>
<td>${r.out}</td>
<td>${h}</td>
<td>${r.post}</td>
<td><button onclick="edit(${r.id})">‚úèÔ∏è</button></td>
<td><button onclick="del(${r.id})">‚ùå</button></td>
`;

tbody.appendChild(tr);
});

footer.innerText="Total Duty: "+arr.length+" | Total Hours: "+total.toFixed(2);
}


/* ========= EDIT DELETE ========= */

function edit(id){
let r=data.find(x=>x.id===id);

date.value=r.date;
in.value=r.in;
out.value=r.out;
post.value=r.post;
bg.value=r.bg;
font.value=r.font;

data.forEach(x=>delete x.editing);
r.editing=true;
}

function del(id){
if(confirm("Delete entry?")){
data=data.filter(x=>x.id!==id);
saveData();
render();
}
}


/* ========= MONTH ========= */

function initMonth(){
let cur=new Date().getMonth()+1;

monthFilter.innerHTML='<option value="all">All</option>';

for(let i=1;i<=12;i++){
let mm=i.toString().padStart(2,'0');
let o=document.createElement("option");
o.value=mm;
o.text=mm;
if(i===cur)o.selected=true;
monthFilter.appendChild(o);
}
}


/* ========= EXCEL ========= */

function exportExcel(){
let rows=[...document.querySelectorAll("table tr")];
let csv=rows.map(r=>[...r.children].map(c=>c.innerText).join(",")).join("\n");
let blob=new Blob([csv]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="attendance.csv";
a.click();
}

</script>
</body>
</html>
