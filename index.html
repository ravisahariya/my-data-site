<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Register + Attendance</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f5132;
}
.card{
  max-width:420px;
  margin:40px auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
.hidden{display:none;}
h2{text-align:center;}
select,input,button{
  width:100%;
  padding:10px;
  margin-top:8px;
}
button{
  background:#0f5132;
  color:#fff;
  border:none;
  border-radius:5px;
}
.settings{
  position:absolute;
  top:15px;
  right:20px;
  cursor:pointer;
  font-size:20px;
}
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.popup .box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:260px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:13px;
}
th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}
tfoot td{font-weight:bold;}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
<h2>üë§ Admin Login</h2>
<select>
<option><b>ADMIN</b></option>
</select>
<input type="password" id="pass" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appPage" class="card hidden">
<div class="settings" onclick="openSettings()">‚öôÔ∏è</div>
<h2>Register + Attendance</h2>

<select id="month" onchange="loadData()">
<option>January</option><option>February</option><option>March</option>
<option>April</option><option>May</option><option>June</option>
<option>July</option><option>August</option><option>September</option>
<option>October</option><option>November</option><option>December</option>
</select>

<input type="date" id="date">
<select id="shift">
<option>Day</option>
<option>Night</option>
</select>

<select id="post">
<option>COE</option><option>ABEER</option><option>DENIEM</option>
<option>ETP</option><option>ACL</option><option>BORD2</option>
<option>CASUAL</option><option>CCTV</option>
</select>

<select disabled>
<option>Ravi</option>
</select>

<input type="color" id="color">
<button onclick="save()">Save Entry</button>

<div style="max-height:250px;overflow:auto">
<table>
<thead>
<tr><th>Date</th><th>Day</th><th>Night</th><th>Post</th><th>Edit</th><th>Del</th></tr>
</thead>
<tbody id="rows"></tbody>
<tfoot>
<tr>
<td>Total</td>
<td id="dayC">0</td>
<td id="nightC">0</td>
<td colspan="3"></td>
</tr>
</tfoot>
</table>
</div>

<button onclick="downloadCSV()">Download CSV</button>
</div>

<!-- SETTINGS -->
<div id="settingsPopup" class="popup hidden">
<div class="box">
<h3>Settings</h3>
<button onclick="logout()">Logout</button>
<button onclick="closeSettings()">Close</button>
</div>
</div>

<script>
const loginPage=document.getElementById("loginPage");
const appPage=document.getElementById("appPage");
const rows=document.getElementById("rows");
const settingsPopup=document.getElementById("settingsPopup");

function login(){
  if(pass.value==="7024"){
    localStorage.login="yes";
    showApp();
  }else alert("Wrong password");
}

function showApp(){
  loginPage.classList.add("hidden");
  appPage.classList.remove("hidden");
  loadData();
}

function logout(){
  localStorage.removeItem("login");
  closeSettings();
  appPage.classList.add("hidden");
  loginPage.classList.remove("hidden");
}

function openSettings(){settingsPopup.classList.remove("hidden")}
function closeSettings(){settingsPopup.classList.add("hidden")}

function key(){return month.value}

function save(){
  if(!date.value){alert("Date required");return}
  let data=JSON.parse(localStorage[key()]||"[]");
  data.unshift({
    d:date.value,
    s:shift.value,
    p:post.value,
    c:color.value
  });
  localStorage[key()]=JSON.stringify(data);
  loadData();
}

function loadData(){
  rows.innerHTML="";
  let d=JSON.parse(localStorage[key()]||"[]");
  let day=0,night=0;
  d.forEach((r,i)=>{
    if(r.s==="Day")day++; else night++;
    rows.innerHTML+=`
    <tr style="color:${r.c}">
      <td>${r.d}</td>
      <td>${r.s==="Day"?"P":""}</td>
      <td>${r.s==="Night"?"P":""}</td>
      <td>${r.p}</td>
      <td><button onclick="edit(${i})">‚úèÔ∏è</button></td>
      <td><button onclick="del(${i})">‚ùå</button></td>
    </tr>`;
  });
  dayC.innerText=day;
  nightC.innerText=night;
}

function del(i){
  if(confirm("Delete entry?")){
    let d=JSON.parse(localStorage[key()]);
    d.splice(i,1);
    localStorage[key()]=JSON.stringify(d);
    loadData();
  }
}

function edit(i){
  let d=JSON.parse(localStorage[key()]);
  date.value=d[i].d;
  shift.value=d[i].s;
  post.value=d[i].p;
  color.value=d[i].c;
  del(i);
}

function downloadCSV(){
  let d=JSON.parse(localStorage[key()]||"[]");
  let csv="Date,Shift,Post\n";
  d.forEach(r=>csv+=`${r.d},${r.s},${r.p}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="attendance.csv";
  a.click();
}

if(localStorage.login==="yes")showApp();
</script>

</body>
</html>
