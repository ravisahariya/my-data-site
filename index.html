<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance Master</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(135deg,#6a6ff5,#9b59b6);
}

/* ---------- LOGIN ---------- */
#loginBox{
  width:360px;
  background:#fff;
  padding:25px;
  border-radius:12px;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  text-align:center;
}
#loginBox h2{margin:5px 0}
#loginBox input{
  width:100%;
  padding:12px;
  margin:8px 0;
  font-size:18px;
}
#loginBox button{
  width:100%;
  padding:12px;
  font-size:18px;
  cursor:pointer;
}
#secretBtn{background:none;border:none;color:#555;margin-top:10px}

/* ---------- HEADER ---------- */
header{
  background:#1976d2;
  color:#fff;
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header b{font-size:18px}
#logout{
  background:red;
  color:#fff;
  border:none;
  padding:8px 12px;
}

/* ---------- ENTRY FORM ---------- */
#formBox{
  background:#dceeff;
  padding:10px;
}
#formBox input,#formBox select{
  padding:6px;
  margin:3px;
}

/* ---------- TABLE ---------- */
#tableWrap{
  height:55vh;
  overflow:auto;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}
th{background:#ffd6d6;position:sticky;top:0}

/* ---------- FOOTER ---------- */
footer{
  background:#ffeb99;
  padding:8px;
  position:fixed;
  bottom:0;
  width:100%;
  font-weight:bold;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>üîê Attendance Login</h2>
  <div id="clock"></div>
  <input id="u" placeholder="Username">
  <input id="p" type="password" placeholder="Password">
  <button onclick="login()">ADMIN</button>
  <button id="secretBtn" onclick="secret()">üîë Secret</button>
</div>

<!-- MAIN APP -->
<div id="app" style="display:none">

<header>
  <b>üìä ATTENDANCE MASTER DATA</b>
  <button id="logout" onclick="logout()">Logout</button>
</header>

<div id="formBox">
  Date <input type="date" id="date">
  In <input type="time" id="in">
  Out <input type="time" id="out">
  Post <input id="post">
  <button onclick="save()">Save</button>

  <select id="month"></select>
  <button onclick="exportExcel()">Excel</button>
  <button onclick="window.print()">Print</button>
</div>

<div id="tableWrap">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th>
<th>Post</th><th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<footer>
Total Duty: <span id="duty">0</span> |
Total Hours: <span id="hours">0</span>
</footer>

</div>

<script>
/* -------- CLOCK -------- */
setInterval(()=>{
  clock.innerText=new Date().toLocaleString();
},1000);

/* -------- AUTH -------- */
let auth=JSON.parse(localStorage.getItem("auth"))||
{u:"9823087",p:"7284"};

function login(){
  if(u.value==auth.u && p.value==auth.p){
    loginBox.style.display="none";
    app.style.display="block";
    render();
  }else alert("Wrong Login");
}
function logout(){
  app.style.display="none";
  loginBox.style.display="block";
}
function secret(){
  let s=prompt("Enter Secret");
  if(s!=="1995")return;
  let nu=prompt("New Username",auth.u);
  let np=prompt("New Password");
  let cp=prompt("Confirm Password");
  if(np!==cp)return alert("Not Match");
  auth={u:nu,p:np};
  localStorage.setItem("auth",JSON.stringify(auth));
  alert("Updated");
}

/* -------- DATA -------- */
let data=JSON.parse(localStorage.getItem("data"))||[];

const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
monthNames.forEach((m,i)=>{
  let o=document.createElement("option");
  o.value=i;o.text=m;month.appendChild(o);
});
month.value=new Date().getMonth();
month.onchange=render;

function save(){
  let d=date.value;
  let i=in.value;
  let o=out.value;
  if(!d||!i||!o)return;
  let h=((new Date(d+" "+o)-new Date(d+" "+i))/36e5);
  if(h<0)h+=24;
  data.push({d,i,o,h:h.toFixed(2),p:post.value});
  localStorage.setItem("data",JSON.stringify(data));
  render();
}

function render(){
  tbody.innerHTML="";
  let td=0,th=0;
  data.forEach((r,idx)=>{
    if(new Date(r.d).getMonth()!=month.value)return;
    td++;th+=Number(r.h);
    tbody.innerHTML+=`
    <tr>
      <td>${r.d}</td>
      <td>${r.i}</td>
      <td>${r.o}</td>
      <td>${r.h}</td>
      <td>${r.p}</td>
      <td><button onclick="edit(${idx})">‚úèÔ∏è</button></td>
      <td><button onclick="del(${idx})">‚ùå</button></td>
    </tr>`;
  });
  duty.innerText=td;
  hours.innerText=th.toFixed(2);
}

function del(i){
  if(confirm("Delete?")){
    data.splice(i,1);
    localStorage.setItem("data",JSON.stringify(data));
    render();
  }
}
function edit(i){
  let r=data[i];
  date.value=r.d;in.value=r.i;out.value=r.o;post.value=r.p;
  del(i);
}
</script>
</body>
</html>
