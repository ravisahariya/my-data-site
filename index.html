<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Register + Attendance</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f4d2e;
}
.card{
  max-width:420px;
  margin:40px auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
}
h2{text-align:center;margin:10px 0}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
}
button{
  background:#0f4d2e;
  color:#fff;
  border:none;
  border-radius:6px;
}
.hidden{display:none}
.settings{
  position:absolute;
  right:15px;
  top:15px;
  font-size:22px;
  cursor:pointer;
}
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:flex;
  align-items:center;
  justify-content:center;
}
.popup-box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:260px;
  text-align:center;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:13px;
  text-align:center;
}
tbody{display:block;max-height:200px;overflow:auto}
thead,tr{display:table;width:100%;table-layout:fixed}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
  <h2>üë§ Admin Login</h2>
  <select disabled><option>ADMIN</option></select>
  <input type="password" id="pass" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appPage" class="card hidden">
  <span class="settings" onclick="openSettings()">‚öôÔ∏è</span>
  <h2>Register + Attendance</h2>

  <select id="month" onchange="render()">
    <option value="">Select Month</option>
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <input type="date" id="date">

  <select id="shift">
    <option>Day</option>
    <option>Night</option>
  </select>

  <select id="post">
    <option>COE</option><option>ABEER</option><option>DENIEM</option>
    <option>ETP</option><option>ACL</option><option>BORD2</option>
    <option>CASUAL</option><option>CCTV</option>
  </select>

  <input type="color" id="color" value="#ffffff">

  <button onclick="saveEntry()">Save Entry</button>

  <table>
    <thead>
      <tr><th>Date</th><th>Shift</th><th>Post</th><th>Sign</th><th>Edit</th><th>Del</th></tr>
    </thead>
    <tbody id="rows"></tbody>
    <tfoot>
      <tr><th>Total</th><th id="dayT">0</th><th id="nightT">0</th><th colspan="3"></th></tr>
    </tfoot>
  </table>

  <button onclick="downloadCSV()">Download CSV</button>
</div>

<!-- SETTINGS -->
<div id="settingsPopup" class="popup hidden">
  <div class="popup-box">
    <h3>Settings</h3>
    <button onclick="logout()">Logout</button>
    <button onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
const loginPage=document.getElementById("loginPage");
const appPage=document.getElementById("appPage");
const settingsPopup=document.getElementById("settingsPopup");

let data=JSON.parse(localStorage.getItem("data")||"[]");

function login(){
  if(document.getElementById("pass").value==="7024"){
    localStorage.setItem("login","yes");
    checkLogin();
  }else alert("Wrong password");
}

function logout(){
  localStorage.removeItem("login");
  checkLogin();
}

function checkLogin(){
  if(localStorage.getItem("login")==="yes"){
    loginPage.classList.add("hidden");
    appPage.classList.remove("hidden");
  }else{
    loginPage.classList.remove("hidden");
    appPage.classList.add("hidden");
  }
  settingsPopup.classList.add("hidden");
}
checkLogin();

function openSettings(){settingsPopup.classList.remove("hidden")}
function closeSettings(){settingsPopup.classList.add("hidden")}

function saveEntry(){
  const m=month.value;
  const d=date.value;
  if(!m||!d){alert("Month & Date required");return;}
  data.unshift({
    m, d,
    s:shift.value,
    p:post.value,
    c:color.value,
    sign:"Ravi"
  });
  localStorage.setItem("data",JSON.stringify(data));
  render();
}

function render(){
  rows.innerHTML="";
  let day=0,night=0;
  data.filter(x=>x.m===month.value).forEach((x,i)=>{
    if(x.s==="Day")day++; else night++;
    rows.innerHTML+=`
    <tr style="background:${x.c}">
      <td>${x.d}</td><td>${x.s}</td><td>${x.p}</td><td>${x.sign}</td>
      <td><button onclick="edit(${i})">‚úèÔ∏è</button></td>
      <td><button onclick="del(${i})">üóë</button></td>
    </tr>`;
  });
  dayT.innerText=day;
  nightT.innerText=night;
}

function del(i){
  if(confirm("Delete?")){
    data.splice(i,1);
    localStorage.setItem("data",JSON.stringify(data));
    render();
  }
}
function edit(i){
  post.value=data[i].p;
  shift.value=data[i].s;
  color.value=data[i].c;
}

function downloadCSV(){
  let csv="Date,Shift,Post,Sign\n";
  data.forEach(x=>csv+=`${x.d},${x.s},${x.p},${x.sign}\n`);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="attendance.csv";
  a.click();
}
</script>

</body>
</html>
