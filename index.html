<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Attendance Cloud Master</title>

<!-- Firebase SIMPLE CDN (NO MODULE = NO BLANK BUG) -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}

/* LOGIN */
#loginPage{
height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(135deg,#667eea,#764ba2);
}
.card{background:#fff;padding:25px;width:90%;max-width:320px;text-align:center;border-radius:10px}

input,select,button{padding:8px;margin:4px}
button{background:#4CAF50;color:white;border:none}

/* APP */
#app{display:none;height:100vh;flex-direction:column}
.topbar{display:flex;justify-content:space-between;padding:8px}
.logout{background:#f44336}

.table-box{flex:1;overflow:auto;background:white}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#ffd9d9}
.total{background:#ffeaa7;font-weight:bold}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="card">
    <h2>üîê Login</h2>
    <input id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div onclick="unlockSecret()" style="cursor:pointer">üîí</div>
  </div>
</div>

<!-- APP -->
<div id="app">

<div class="topbar">
  <h3>‚òÅÔ∏è Attendance Cloud</h3>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div>
<input type="date" id="date">
<input type="time" id="inTime">
<input type="time" id="outTime">
<input id="post" placeholder="Post">
<button onclick="save()">Save</button>
</div>

<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th><th>Post</th><th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>

<tfoot>
<tr class="total">
<td>Total Duty: <span id="duty">0</span></td>
<td colspan="2">Total Hours</td>
<td id="hours">0</td>
<td></td>
</tr>
</tfoot>
</table>
</div>

</div>


<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey:"AIzaSyD71mpolAsmejtU2icecQQcX07iCW_is0Y",
  authDomain:"ravicardmaker.firebaseapp.com",
  projectId:"ravicardmaker"
});

const db = firebase.firestore();

/* ================= LOGIN ================= */
if(localStorage.getItem("login")) showApp();

function login(){
 if(username.value==="Ravi" && password.value==="Ravi123"){
   localStorage.setItem("login","1");
   showApp();
 }
}

function logout(){
 localStorage.removeItem("login");
 location.reload();
}

function showApp(){
 loginPage.style.display="none";
 app.style.display="flex";
}

function unlockSecret(){
 if(prompt("Year?")==="1995")
   alert("Username: Ravi\nPassword: Ravi123");
}

/* ================= DATA ================= */
let data=[];

db.collection("attendance").onSnapshot(snap=>{
 data=[];
 snap.forEach(d=>data.push({id:d.id,...d.data()}));
 render();
});

function save(){
 let d=date.value,i=inTime.value,o=outTime.value,p=post.value;
 if(!d||!i||!o||!p) return;

 let h=((new Date("2000 "+o)-new Date("2000 "+i))/3600000).toFixed(2);

 db.collection("attendance").add({d,i,o,p,h});
}

function del(id){
 if(confirm("Delete?"))
  db.collection("attendance").doc(id).delete();
}

function render(){
 tbody.innerHTML="";
 let th=0, td=0;

 data.forEach(r=>{
   th+=+r.h; td++;

   tbody.innerHTML+=`
   <tr>
   <td>${r.d}</td>
   <td>${r.i}</td>
   <td>${r.o}</td>
   <td>${r.h}</td>
   <td>${r.p}</td>
   <td><button onclick="del('${r.id}')">‚ùå</button></td>
   </tr>`;
 });

 hours.innerText=th.toFixed(2);
 duty.innerText=td;
}
</script>

</body>
</html>
