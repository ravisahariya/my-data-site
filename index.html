<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register + Attendance</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f3d2e;
  color:#000;
}
.hidden{display:none}

.card{
  background:#fff;
  max-width:420px;
  margin:40px auto;
  padding:20px;
  border-radius:10px;
}
h2{text-align:center;margin:5px 0 15px}

select,input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
}

button{
  background:#0f5132;
  color:#fff;
  border:none;
  border-radius:5px;
}
button.red{background:#c0392b}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.gear{
  cursor:pointer;
  font-size:20px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:13px;
}
th,td{
  border:1px solid #ccc;
  padding:5px;
  text-align:center;
}

.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.popup .box{
  background:#fff;
  padding:20px;
  width:260px;
  border-radius:8px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
  <h2>üë§ Admin Login</h2>
  <select id="adminId">
    <option>ADMIN</option>
  </select>
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appPage" class="card hidden">
  <div class="topbar">
    <h2>Register + Attendance</h2>
    <span class="gear" onclick="openSettings()">‚öôÔ∏è</span>
  </div>

  <select id="month" onchange="render()">
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <input type="date" id="date">
  <select id="shift">
    <option>Day</option>
    <option>Night</option>
  </select>

  <select id="post">
    <option>COE</option><option>ABEER</option><option>DENIEM</option>
    <option>ETP</option><option>ACL</option><option>BORD2</option>
    <option>CASUAL</option><option>CCTV</option>
  </select>

  <input type="color" id="color" value="#ffffff">
  <button onclick="save()">Save Entry</button>

  <div style="max-height:200px;overflow:auto">
    <table>
      <thead>
        <tr><th>Date</th><th>Day</th><th>Night</th><th>Post</th><th>Edit</th><th>Del</th></tr>
      </thead>
      <tbody id="rows"></tbody>
      <tfoot>
        <tr>
          <th>Total</th>
          <th id="dTotal">0</th>
          <th id="nTotal">0</th>
          <th colspan="3"></th>
        </tr>
      </tfoot>
    </table>
  </div>

  <button onclick="downloadCSV()">Download CSV</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="popup hidden">
  <div class="box">
    <h3>Settings</h3>
    <button onclick="logout()">Logout</button>
    <button onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
const loginPage=document.getElementById("loginPage");
const appPage=document.getElementById("appPage");
const settings=document.getElementById("settings");
const rowsEl=document.getElementById("rows");

function checkLogin(){
  settings.classList.add("hidden");
  if(localStorage.getItem("login")==="yes"){
    loginPage.classList.add("hidden");
    appPage.classList.remove("hidden");
  }else{
    loginPage.classList.remove("hidden");
    appPage.classList.add("hidden");
  }
}
checkLogin();

function login(){
  if(password.value==="7024"){
    localStorage.setItem("login","yes");
    checkLogin();
  }else alert("Wrong password");
}

function logout(){
  localStorage.removeItem("login");
  checkLogin();
}

function openSettings(){settings.classList.remove("hidden")}
function closeSettings(){settings.classList.add("hidden")}

function key(){
  return "data_"+month.value;
}

function save(){
  if(!date.value){alert("Date required");return}
  let data=JSON.parse(localStorage.getItem(key())||"[]");
  data.push({
    date:date.value,
    shift:shift.value,
    post:post.value,
    color:color.value
  });
  localStorage.setItem(key(),JSON.stringify(data));
  render();
}

function render(){
  let data=JSON.parse(localStorage.getItem(key())||"[]");
  data.sort((a,b)=>a.date.localeCompare(b.date));
  rowsEl.innerHTML="";
  let d=0,n=0;

  data.forEach((x,i)=>{
    if(x.shift==="Day")d++; else n++;
    let tr=document.createElement("tr");
    tr.style.background=x.color;
    tr.innerHTML=`
      <td>${x.date}</td>
      <td>${x.shift==="Day"?"P":""}</td>
      <td>${x.shift==="Night"?"P":""}</td>
      <td>${x.post}</td>
      <td><button onclick="edit(${i})">‚úèÔ∏è</button></td>
      <td><button onclick="del(${i})">‚ùå</button></td>`;
    rowsEl.appendChild(tr);
  });
  dTotal.textContent=d;
  nTotal.textContent=n;
}

function edit(i){
  let data=JSON.parse(localStorage.getItem(key()));
  let x=data[i];
  date.value=x.date;
  shift.value=x.shift;
  post.value=x.post;
  color.value=x.color;
  del(i);
}

function del(i){
  if(!confirm("Delete entry?"))return;
  let data=JSON.parse(localStorage.getItem(key()));
  data.splice(i,1);
  localStorage.setItem(key(),JSON.stringify(data));
  render();
}

function downloadCSV(){
  let data=JSON.parse(localStorage.getItem(key())||"[]");
  let csv="Date,Shift,Post\n";
  data.forEach(x=>csv+=`${x.date},${x.shift},${x.post}\n`);
  let a=document.createElement("a");
  a.href="data:text/csv,"+encodeURIComponent(csv);
  a.download="attendance.csv";
  a.click();
}
</script>

</body>
</html>
