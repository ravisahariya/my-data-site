<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Attendance MASTER</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial}

/* LOGIN */
#loginPage{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(135deg,#5f72ff,#9b59ff);
color:#fff;
}

.loginCard{
background:#fff;
color:#000;
padding:40px;
width:95%;
max-width:480px;
border-radius:20px;
text-align:center;
box-shadow:0 10px 25px rgba(0,0,0,.3);
}

.loginCard h1{font-size:32px;margin-bottom:10px}
.clock{font-size:20px;margin-bottom:20px;font-weight:bold}

input,select,button{
padding:10px;
margin:5px;
font-size:16px;
}

button{cursor:pointer}

.secretBtn{color:#666;background:none;border:none}

.logout{
background:#e53935;
color:#fff;
border:none;
padding:8px 12px;
}

/* APP */
#app{display:none;height:100vh;flex-direction:column}

/* HEADER */
.header{
background:#1976d2;
color:#fff;
padding:8px;
display:flex;
justify-content:space-between;
align-items:center;
}

/* ENTRY FORM BLUE */
.formBox{
background:#e3f2fd;
padding:6px;
}

/* TABLE */
.tableBox{
flex:1;
overflow:auto;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
border:1px solid #ccc;
padding:6px;
text-align:center;
}

th{background:#ffe0e0}

/* FOOTER */
.footer{
background:#ffeaa7;
padding:6px;
font-weight:bold;
}

/* SECRET POPUP */
#secretBox{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,.6);
justify-content:center;
align-items:center;
}

.secretCard{
background:#fff;
padding:20px;
width:90%;
max-width:420px;
border-radius:12px;
}

.green{
background:#4caf50;
color:#fff;
border:none;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
<div class="loginCard">

<h1>üîê Attendance Login</h1>
<div id="clock" class="clock"></div>

<input id="u" placeholder="Username"><br>
<input id="p" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button><br>
<button class="secretBtn" onclick="openSecret()">üîí Secret</button>

</div>
</div>

<!-- SECRET SETTINGS -->
<div id="secretBox">
<div class="secretCard">

<b>Current Username:</b> <span id="cu"></span><br>
<b>Current Password:</b> <span id="cp"></span><hr>

<input id="oldPass" placeholder="Old Password">
<input id="newUser" placeholder="New Username">
<input id="newPass" placeholder="New Password">
<input id="confirmPass" placeholder="Confirm Password">

<button class="green" onclick="saveSecret()">Save</button>
<button onclick="closeSecret()">Close</button>

</div>
</div>


<!-- APP -->
<div id="app">

<div class="header">
<b>Attendance MASTER</b>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div class="formBox">
<input type="date" id="d">
<input type="time" id="i">
<input type="time" id="o">
<input id="post" placeholder="Post">
<input type="color" id="bg" value="#ffffff">
<input type="color" id="font" value="#000000">

<button onclick="save()">Save</button>

<select id="month" onchange="render()"></select>

<button onclick="excel()">Excel</button>
<button onclick="window.print()">Print</button>
</div>

<div class="tableBox">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th><th>Post</th><th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="tb"></tbody>
</table>
</div>

<div class="footer">
Total Duty: <span id="td">0</span> |
Total Hours: <span id="th">0</span>
</div>

</div>


<script>
/* CLOCK */
setInterval(()=>{
let now=new Date();
clock.innerText=
now.toDateString()+" "+
now.toLocaleTimeString('en-GB');
},1000);

/* DEFAULT LOGIN */
if(!localStorage.getItem("user")){
localStorage.setItem("user","9823087");
localStorage.setItem("pass","7284");
}

let user=()=>localStorage.getItem("user");
let pass=()=>localStorage.getItem("pass");

/* LOGIN */
if(localStorage.getItem("login")) showApp();

function login(){
if(u.value===user() && p.value===pass()){
localStorage.setItem("login","1");
showApp();
}else alert("Wrong login");
}

function logout(){
localStorage.removeItem("login");
location.reload();
}

function showApp(){
loginPage.style.display="none";
app.style.display="flex";
}

/* SECRET */
function openSecret(){
let y=prompt("Enter secret code");
if(y==="1995"){
cu.innerText=user();
cp.innerText=pass();
secretBox.style.display="flex";
}
}

function closeSecret(){
secretBox.style.display="none";
}

function saveSecret(){
if(oldPass.value!==pass()) return alert("Wrong old password");
if(newPass.value!==confirmPass.value) return alert("Password mismatch");

localStorage.setItem("user",newUser.value);
localStorage.setItem("pass",newPass.value);

alert("Updated");
closeSecret();
}

/* FIREBASE */
firebase.initializeApp({
apiKey:"AIzaSyD71mpolAsmejtU2icecQQcX07iCW_is0Y",
authDomain:"ravicardmaker.firebaseapp.com",
projectId:"ravicardmaker"
});
const db=firebase.firestore();

let data=[],editId=null;

db.collection("attendance").onSnapshot(s=>{
data=[];
s.forEach(d=>data.push({id:d.id,...d.data()}));
render();
});

/* HOURS */
function calc(i,o){
let a=new Date("2000 "+i),b=new Date("2000 "+o);
if(b<a)b.setDate(b.getDate()+1);
return ((b-a)/3600000).toFixed(2);
}

/* SAVE */
function save(){
let obj={
d:d.value,i:i.value,o:o.value,
h:calc(i.value,o.value),
p:post.value,bg:bg.value,font:font.value
};

if(editId) db.collection("attendance").doc(editId).update(obj);
else db.collection("attendance").add(obj);

editId=null;
}

/* EDIT */
function edit(id){
let r=data.find(x=>x.id===id);
editId=id;
d.value=r.d;i.value=r.i;o.value=r.o;
post.value=r.p;bg.value=r.bg;font.value=r.font;
}

/* DELETE */
function del(id){
if(confirm("Delete?")) db.collection("attendance").doc(id).delete();
}

/* MONTH */
for(let m=1;m<=12;m++){
month.innerHTML+=`<option value="${String(m).padStart(2,'0')}">${new Date(2025,m-1).toLocaleString('en',{month:'long'})}</option>`;
}
month.value=String(new Date().getMonth()+1).padStart(2,'0');

/* RENDER */
function render(){
tb.innerHTML="";
let totalH=0,totalD=0;

data.forEach(r=>{
if(r.d.split("-")[1]!==month.value) return;

totalD++; totalH+=+r.h;

tb.innerHTML+=`
<tr style="background:${r.bg};color:${r.font}">
<td>${r.d}</td>
<td>${r.i}</td>
<td>${r.o}</td>
<td>${r.h}</td>
<td>${r.p}</td>
<td><button onclick="edit('${r.id}')">‚úèÔ∏è</button></td>
<td><button onclick="del('${r.id}')">‚ùå</button></td>
</tr>`;
});

td.innerText=totalD;
th.innerText=totalH.toFixed(2);
}

/* EXCEL */
function excel(){
let csv="Date,In,Out,Hours,Post\n";
data.forEach(r=>csv+=`${r.d},${r.i},${r.o},${r.h},${r.p}\n`);
let blob=new Blob([csv]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="attendance.csv";
a.click();
}
</script>

</body>
  </html>
