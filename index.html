<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Master Attendance Sheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#eaeaea}
.hidden{display:none}

/* HEADER */
.header{
  background:#0d6efd;color:#fff;padding:12px;
  display:flex;justify-content:space-between;align-items:center;
  font-size:22px
}
.logout{background:red;color:#fff;border:none;padding:8px 12px;border-radius:8px}

/* SUMMARY */
.summary{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:10px}
.box{color:#fff;padding:12px;border-radius:10px;text-align:center;font-weight:bold}
.box span{display:block;font-size:26px}
.g{background:#198754}.o{background:#fd7e14}.p{background:#6f42c1}

/* FORM */
.form{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;padding:10px}
.form input,.form select{padding:8px}
.add{background:#0d6efd;color:#fff;border:none;border-radius:8px}

/* TABLE */
.tableWrap{margin:10px;max-height:60vh;overflow:auto;border-radius:10px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:8px;border-bottom:1px solid #ddd;text-align:center}
th{background:#f1f1f1;position:sticky;top:0}

/* Night highlight */
.night{background:#f1e8ff}

/* Icons */
.action i{
  font-size:18px;cursor:pointer;margin:0 6px;
  opacity:.3;transition:.2s
}
tr:hover .action i{opacity:1}
.edit{color:#ff9800}
.del{color:#f44336}
</style>
</head>

<body>

<div class="header">
  Master Attendance Sheet
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="summary">
  <div class="box g">Total Days<span id="tDays">0</span></div>
  <div class="box o">Total Hours<span id="tHours">0</span></div>
  <div class="box p">Total Posts<span id="tPosts">0</span></div>
</div>

<div class="form">
  <input type="date" id="date">
  <input type="time" id="inTime">
  <input type="time" id="outTime">
  <input id="post" placeholder="Post">
  <select id="monthFilter" onchange="render()"></select>
  <button class="add" onclick="addEntry()">ADD</button>
</div>

<div class="tableWrap">
<table>
<thead>
<tr>
  <th>Date</th><th>In</th><th>Out</th>
  <th>Hours</th><th>Post</th><th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<script>
// üî• FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyD71mpolAsmejtU2icecQQcX07iCW_is0Y",
  authDomain: "ravicardmaker.firebaseapp.com",
  projectId: "ravicardmaker",
  storageBucket: "ravicardmaker.firebasestorage.app",
  messagingSenderId: "125321734592",
  appId: "1:125321734592:web:eaba2d7477376694134025"
});
const db=firebase.firestore();

let allData=[],editId=null;

// MONTHS
const months=["All Months","January","February","March","April","May","June","July","August","September","October","November","December"];
months.forEach((m,i)=>{
  let o=document.createElement("option");
  o.value=i;o.text=m;monthFilter.appendChild(o);
});
monthFilter.value=new Date().getMonth()+1;
date.value=new Date().toISOString().slice(0,10);

// TIME FORMAT
function ampm(t){
  if(!t)return"-";
  let [h,m]=t.split(":");
  h=parseInt(h);
  let ap=h>=12?"PM":"AM";
  h=h%12||12;
  return `${h}:${m} ${ap}`;
}

// ADD
function addEntry(){
  let d=date.value,i=inTime.value,o=outTime.value,p=post.value;
  if(!d||!p)return alert("Date & Post required");

  let start=new Date(d+"T"+i);
  let end=new Date(d+"T"+o);
  let night=false;

  if(o && i && end<start){
    end.setDate(end.getDate()+1);
    night=true;
  }

  let hrs=i&&o?((end-start)/3600000).toFixed(2):"0.00";

  let data={date:d,in:i,out:o,hours:hrs,post:p,night};

  if(editId){
    db.collection("attendance").doc(editId).set(data);
    editId=null;
  }else db.collection("attendance").add(data);

  inTime.value=outTime.value=post.value="";
}

// LOAD
db.collection("attendance").orderBy("date").onSnapshot(s=>{
  allData=[];
  s.forEach(d=>allData.push({id:d.id,...d.data()}));
  render();
});

// RENDER
function render(){
  let sel=parseInt(monthFilter.value);
  let html="",hrs=0,dates=new Set(),posts=new Set();

  allData.forEach(r=>{
    let m=new Date(r.date).getMonth()+1;
    if(sel===0||m===sel){
      hrs+=+r.hours;
      dates.add(r.date);
      posts.add(r.post);

      html+=`
      <tr class="${r.night?'night':''}">
        <td>${r.date}</td>
        <td>${ampm(r.in)}</td>
        <td>${ampm(r.out)}</td>
        <td>${r.hours}</td>
        <td>${r.post}</td>
        <td class="action">
          <i class="edit" onclick="editEntry('${r.id}')">‚úèÔ∏è</i>
          <i class="del" onclick="delEntry('${r.id}')">üóëÔ∏è</i>
        </td>
      </tr>`;
    }
  });

  tbody.innerHTML=html;
  tDays.innerText=dates.size;
  tHours.innerText=hrs.toFixed(2);
  tPosts.innerText=posts.size;
}

// EDIT / DELETE
function editEntry(id){
  let r=allData.find(x=>x.id===id);
  date.value=r.date;inTime.value=r.in;outTime.value=r.out;post.value=r.post;
  editId=id;
}
function delEntry(id){
  if(confirm("Delete entry?"))
    db.collection("attendance").doc(id).delete();
}

function logout(){location.reload();}
</script>

</body>
</html>
