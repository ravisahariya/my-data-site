<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Attendance Pro</title>

<style>

body{
  margin:0;
  font-family:Arial;
  height:100vh;
  overflow:hidden;
  background:#f2f2f2;
}

.app{
  height:100vh;
  display:flex;
  flex-direction:column;
  padding:8px;
}

h2{
  text-align:center;
  margin:4px;
}

/* ===== FORM ===== */
.form{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
}

input,select,button{
  padding:8px;
  font-size:14px;
}

button{
  background:#4CAF50;
  color:white;
  border:none;
  border-radius:6px;
}

/* ===== TOOLS ===== */
.tools{
  display:flex;
  gap:6px;
  margin-top:6px;
}

.tools input,.tools select{
  flex:1;
}

/* ===== TABLE SCROLL ===== */
.table-box{
  flex:1;
  overflow:auto;
  background:white;
  margin-top:6px;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

th,td{
  border:1px solid #ddd;
  padding:6px;
  text-align:center;
}

th{
  background:#ffd9d9;
  position:sticky;
  top:0;
}

.total{
  background:#ffeaa7;
  font-weight:bold;
}

.edit{background:#2196F3;color:white;border:none}
.del{background:#f44336;color:white;border:none}

</style>
</head>


<body>

<div class="app">

<h2>üìã Attendance Register PRO</h2>

<!-- ENTRY FORM -->
<div class="form">
<input type="date" id="date">
<input type="time" id="in">
<input type="time" id="out">

<select id="post">
<option>ETP</option>
<option>BOARD 2</option>
<option>COE</option>
<option>ACL</option>
<option>BEBRIG</option>
</select>

<button onclick="save()">Save Entry</button>
</div>


<!-- TOOLS -->
<div class="tools">
<input type="month" id="monthFilter" onchange="render()">
<input type="text" id="search" placeholder="Search..." onkeyup="render()">
<button onclick="downloadCSV()">Excel</button>
<button onclick="window.print()">Print</button>
</div>


<div class="tools">
<label>BG <input type="color" id="bg"></label>
<label>Font <input type="color" id="font"></label>
</div>


<!-- TABLE -->
<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th>
<th>In</th>
<th>Out</th>
<th>Hr</th>
<th>Post</th>
<th>E</th>
<th>D</th>
</tr>
</thead>

<tbody id="body"></tbody>

<tfoot>
<tr class="total">
<td colspan="3">Grand Total</td>
<td id="total">0</td>
<td colspan="3"></td>
</tr>
</tfoot>

</table>
</div>

</div>



<script>

let data = JSON.parse(localStorage.getItem("attData")) || [];
let editIndex = -1;

/* ===== SAVE ===== */
function save(){

 let d=date.value;
 let i=in.value;
 let o=out.value;
 let p=post.value;

 if(!d||!i||!o) return alert("Fill all fields");

 let h=calcHours(i,o);

 if(editIndex>=0){
   data[editIndex]={d,i,o,h,p};
   editIndex=-1;
 }
 else{
   data.push({d,i,o,h,p});
 }

 store();
 render();
 clear();
}

/* ===== HOURS (Night shift support) ===== */
function calcHours(a,b){
 let x=new Date("2000-01-01 "+a);
 let y=new Date("2000-01-01 "+b);
 if(y<x) y.setDate(y.getDate()+1);
 return ((y-x)/3600000).toFixed(2);
}

/* ===== RENDER TABLE ===== */
function render(){

 body.innerHTML="";
 let totalH=0;

 let month = monthFilter.value;
 let s = search.value.toLowerCase();

 /* AUTO DATE SORT */
 data.sort((a,b)=> new Date(a.d)-new Date(b.d));

 data.forEach((row,index)=>{

   if(month && !row.d.startsWith(month)) return;

   let text = (row.d+row.p).toLowerCase();
   if(s && !text.includes(s)) return;

   totalH += parseFloat(row.h);

   body.innerHTML += `
   <tr>
   <td>${row.d}</td>
   <td>${row.i}</td>
   <td>${row.o}</td>
   <td>${row.h}</td>
   <td>${row.p}</td>
   <td><button class="edit" onclick="edit(${index})">‚úèÔ∏è</button></td>
   <td><button class="del" onclick="del(${index})">‚ùå</button></td>
   </tr>`;
 });

 total.innerText = totalH.toFixed(2);
}

/* ===== EDIT ===== */
function edit(i){
 let r=data[i];
 date.value=r.d;
 in.value=r.i;
 out.value=r.o;
 post.value=r.p;
 editIndex=i;
}

/* ===== DELETE ===== */
function del(i){
 data.splice(i,1);
 store();
 render();
}

/* ===== LOCAL SAVE ===== */
function store(){
 localStorage.setItem("attData",JSON.stringify(data));
}

/* ===== CLEAR ===== */
function clear(){
 date.value="";
 in.value="";
 out.value="";
}

/* ===== CSV DOWNLOAD ===== */
function downloadCSV(){

 let csv="Date,In,Out,Hours,Post\n";

 data.forEach(r=>{
  csv+=`${r.d},${r.i},${r.o},${r.h},${r.p}\n`;
 });

 let blob=new Blob([csv]);
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download
