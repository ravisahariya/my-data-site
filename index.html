<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Attendance MASTER</title>

<!-- ‚úÖ EMBED ICON + PWA (NO EXTRA FILE NEEDED) -->
<link rel="icon" type="image/png"
href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAA...">

<style>
body{margin:0;font-family:Arial}

/* LOGIN */
#loginPage{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(135deg,#667eea,#764ba2);
flex-direction:column;
color:#fff;
}

.clock{
font-size:26px;
font-weight:bold;
margin-bottom:20px;
text-align:center;
}

.loginCard{
background:#fff;
color:#000;
padding:40px;
width:92%;
max-width:450px;
border-radius:20px;
text-align:center;
box-shadow:0 10px 25px rgba(0,0,0,.4);
}

input,select,button{padding:8px;margin:4px}

#app{display:none;height:100vh;flex-direction:column}

/* HEADER */
.topFixed{
background:#0d6efd;
color:#fff;
padding:8px;
position:sticky;
top:0;
}

/* FOOTER */
.bottomFixed{
background:#ffeaa7;
padding:8px;
font-weight:bold;
position:sticky;
bottom:0;
}

/* TABLE SCROLL */
.tableBox{flex:1;overflow:auto;background:#fff}

table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#ffd9d9}

.night{background:#d6ecff}

.logout{background:#f44336;color:#fff;border:none}
.secret{cursor:pointer;margin-top:10px;color:#555}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">

<div class="clock" id="clock"></div>

<div class="loginCard">
<h2>üîê Attendance Login</h2>

<input id="username" placeholder="Username"><br>
<input type="password" id="password" placeholder="Password"><br>
<button onclick="doLogin()">Login</button>

<div class="secret" onclick="secret()">üîí Secret</div>
</div>

</div>

<!-- APP -->
<div id="app">

<div class="topFixed">
Attendance MASTER
<button class="logout" onclick="logout()" style="float:right">Logout</button>
</div>

<div style="padding:6px">
<input type="date" id="date">
<input type="time" id="inTime">
<input type="time" id="outTime">
<input id="post" placeholder="Post">

BG <input type="color" id="bg">
Font <input type="color" id="font">

<button onclick="save()">Save</button>

<select id="monthFilter" onchange="render()"></select>
<button onclick="downloadCSV()">Excel</button>
<button onclick="window.print()">Print</button>
</div>

<div class="tableBox">
<table>
<thead>
<tr>
<th>Date</th><th>In</th><th>Out</th><th>Hours</th>
<th>Post</th><th>Edit</th><th>Delete</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div class="bottomFixed">
Total Duty: <span id="duty">0</span>
&nbsp;&nbsp;
Total Hours: <span id="hours">0</span>
</div>

</div>


<script>

/* ========= LOGIN DATA ========= */
let USER=localStorage.getItem("u")||"Ravi";
let PASS=localStorage.getItem("p")||"Ravi123";

/* ========= CLOCK ========= */
setInterval(()=>{
 let d=new Date();
 clock.innerHTML=
 d.toDateString()+"<br>"+
 d.toLocaleTimeString('en-GB',{hour12:false});
},1000);

/* ========= LOGIN ========= */
if(localStorage.getItem("login")) showApp();

function doLogin(){
 if(username.value===USER && password.value===PASS){
  localStorage.setItem("login",1);
  showApp();
 }else alert("Wrong");
}

function logout(){
 localStorage.clear();
 location.reload();
}

function showApp(){
 loginPage.style.display="none";
 app.style.display="flex";
}

/* ========= SECRET ========= */
function secret(){
 let y=prompt("Enter secret year");
 if(y==="1995"){
  alert("Username: "+USER+"\nPassword: "+PASS);

  let old=prompt("Old Password");
  if(old!==PASS) return;

  let nu=prompt("New Username");
  let np=prompt("New Password");

  if(nu&&np){
   USER=nu;
   PASS=np;
   localStorage.setItem("u",nu);
   localStorage.setItem("p",np);
   alert("Changed!");
  }
 }
}

/* ========= DATA ========= */
let data=[],editIndex=null;

function hours(i,o){
 let a=new Date("2000 "+i);
 let b=new Date("2000 "+o);
 if(b<a)b.setDate(b.getDate()+1);
 return ((b-a)/3600000).toFixed(2);
}

function save(){
 let obj={
  d:date.value,
  i:inTime.value,
  o:outTime.value,
  p:post.value,
  bg:bg.value,
  font:font.value
 };
 obj.h=hours(obj.i,obj.o);

 if(editIndex!=null) data[editIndex]=obj;
 else data.push(obj);

 localStorage.setItem("att",JSON.stringify(data));
 render();
}

data=JSON.parse(localStorage.getItem("att")||"[]");

/* ========= MONTH FILTER ========= */
const months=["All","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
months.forEach((m,i)=>{
 let op=document.createElement("option");
 op.value=i;
 op.text=m;
 monthFilter.appendChild(op);
});
monthFilter.value=new Date().getMonth()+1;

/* ========= RENDER ========= */
function render(){

 tbody.innerHTML="";
 let m=monthFilter.value;

 let td=0,th=0;

 data.forEach((r,i)=>{

  if(m!=0 && r.d.split("-")[1]!=String(m).padStart(2,"0")) return;

  let night=r.o<r.i;

  td++;
  th+=+r.h;

  tbody.innerHTML+=`
  <tr class="${night?'night':''}" style="background:${r.bg};color:${r.font}">
  <td>${r.d}</td>
  <td>${format(r.i)}</td>
  <td>${format(r.o)}</td>
  <td>${r.h}</td>
  <td>${r.p}</td>
  <td><button onclick="edit(${i})">‚úèÔ∏è</button></td>
  <td><button onclick="del(${i})">‚ùå</button></td>
  </tr>`;
 });

 duty.innerText=td;
 hours.innerText=th.toFixed(2);
}

function format(t){
 let [h,m]=t.split(":");
 let am=h>=12?"pm":"am";
 h=h%12||12;
 return h+":"+m+" "+am;
}

function edit(i){
 editIndex=i;
 let r=data[i];
 date.value=r.d;
 inTime.value=r.i;
 outTime.value=r.o;
 post.value=r.p;
 bg.value=r.bg;
 font.value=r.font;
}

function del(i){
 if(confirm("Delete?")){
  data.splice(i,1);
  localStorage.setItem("att",JSON.stringify(data));
  render();
 }
}

/* ========= CSV ========= */
function downloadCSV(){
 let csv="Date,In,Out,Hours,Post\n";
 data.forEach(r=>csv+=`${r.d},${r.i},${r.o},${r.h},${r.p}\n`);
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([csv]));
 a.download="attendance.csv";
 a.click();
}

render();

</script>

</body>
</html>
